<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Permutation in String Visualization</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .char-row { display: flex; justify-content: center; gap: 2px; margin: 10px 0; }
        .char-box { padding: 8px 12px; border-radius: 4px; font-family: monospace; background: rgba(255,255,255,0.1); }
        .char-box.in-window { background: var(--viz-primary); color: white; }
        .freq-display { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; font-family: monospace; font-size: 0.85rem; }
        .freq-item { padding: 4px 8px; border-radius: 4px; background: rgba(0,0,0,0.3); }
        .freq-item.match { color: var(--viz-success); }
        .freq-item.mismatch { color: var(--viz-error); }
    </style>
</head>
<body>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">FIXED WINDOW - PERMUTATION CHECK</div>
                <div style="text-align: center; margin-bottom: 10px;">Pattern: <strong id="patternDisplay"></strong></div>
                <div class="char-row" id="charRow"></div>
                <div class="viz-title" style="margin-top: 15px;">FREQUENCY COMPARISON</div>
                <div class="freq-display" id="freqDisplay"></div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">← Prev</button>
                    <div class="step-indicator">Step <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">Next →</button>
                    <button class="viz-btn" onclick="resetVisualization()">↻ Reset</button>
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">Matches</div><div class="state-value" id="matchDisplay" style="color: var(--viz-success);">0 / 26</div></div>
                </div>
            </div>
            <div class="viz-card">
                <div class="viz-title">EXPLANATION</div>
                <div class="explanation" id="explanation"></div>
            </div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%; box-sizing: border-box;">
                <div class="viz-title">ALGORITHM</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'bool checkInclusion(string s1, string s2) {', id: 0 },
            { line: '    int count1[26], count2[26], matches = 0;', id: 1 },
            { line: '    // Init count1 from s1, count2 from first window', id: 2 },
            { line: '    for (int i = s1.length(); i < s2.length(); i++) {', id: 3 },
            { line: '        // Slide window: add s2[i], remove s2[i-len]', id: 4 },
            { line: '        if (matches == 26) return true;', id: 5 },
            { line: '    }', id: 6 },
            { line: '    return matches == 26;', id: 7 },
            { line: '}', id: 8 },
        ];
        const s1 = "ab", s2 = "eidbaooo";

        function generateAlgorithmSteps() {
            const steps = [];
            const len = s1.length;
            const count1 = {}, count2 = {};
            for (const c of s1) count1[c] = (count1[c] || 0) + 1;
            
            steps.push({ left: 0, right: -1, matches: 0, count1, count2: {}, highlightLines: [0, 1, 2], explanation: { title: 'Init', text: `Pattern "${s1}", window size = ${len}` }});
            
            for (let i = 0; i < s2.length; i++) {
                const left = Math.max(0, i - len + 1);
                const right = i;
                
                // Simulate window
                const windowCount = {};
                for (let j = left; j <= right && j < s2.length; j++) {
                    const c = s2[j];
                    windowCount[c] = (windowCount[c] || 0) + 1;
                }
                
                let matches = 0;
                for (let k = 0; k < 26; k++) {
                    const c = String.fromCharCode(97 + k);
                    if ((count1[c] || 0) === (windowCount[c] || 0)) matches++;
                }
                
                const isMatch = matches === 26;
                steps.push({ left, right, matches, count1, count2: windowCount, found: isMatch, highlightLines: isMatch ? [5] : [3, 4], explanation: { title: `Window [${left}, ${right}]`, text: isMatch ? '✓ Found permutation!' : `Matches: ${matches}/26` }});
                
                if (isMatch) break;
            }
            return steps;
        }

        let viz;
        function init() {
            document.getElementById('patternDisplay').textContent = s1;
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    document.getElementById('charRow').innerHTML = [...s2].map((c, i) => {
                        let cls = 'char-box';
                        if (i >= step.left && i <= step.right) cls += ' in-window';
                        return `<div class="${cls}">${c}</div>`;
                    }).join('');
                    
                    const chars = [...new Set([...Object.keys(step.count1), ...Object.keys(step.count2)])].sort();
                    document.getElementById('freqDisplay').innerHTML = chars.map(c => {
                        const c1 = step.count1[c] || 0, c2 = step.count2[c] || 0;
                        const match = c1 === c2;
                        return `<span class="freq-item ${match ? 'match' : 'mismatch'}">${c}: ${c2}/${c1}</span>`;
                    }).join('') || '-';
                    
                    document.getElementById('matchDisplay').textContent = `${step.matches} / 26`;
                    document.getElementById('matchDisplay').style.color = step.found ? 'var(--viz-success)' : 'var(--viz-text-main)';
                }
            });
            viz.setSteps(generateAlgorithmSteps());
        }
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
