<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koko Eating Bananas ç‚ç‚åƒé¦™è•‰ - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .piles { display: flex; gap: 8px; justify-content: center; align-items: flex-end; margin: 20px 0; height: 120px; flex-wrap: wrap; }
        .pile { display: flex; flex-direction: column; align-items: center; }
        .pile-bar { width: 38px; background: var(--viz-warning); border-radius: 4px 4px 0 0; display: flex; align-items: flex-end; justify-content: center; color: #0f172a; font-weight: bold; padding-bottom: 4px; font-size: 0.9rem; }
        .pile-label { font-size: 0.7rem; color: var(--text-muted); margin-top: 4px; }
        .speed-test { text-align: center; margin: 10px 0; padding: 10px; background: var(--viz-bg-secondary); border-radius: 8px; }
        .speed-test .k { font-size: 1.3rem; font-weight: bold; color: var(--viz-secondary); }
        .speed-test .hours { color: var(--text-muted); }
        .custom-input-section { margin-top: 16px; padding: 16px; background: var(--viz-bg-secondary); border-radius: 10px; border: 1px dashed var(--viz-primary); }
        .input-title { font-weight: 600; margin-bottom: 10px; color: var(--viz-primary); }
        .input-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 8px; }
        .input-row input { flex: 1; min-width: 80px; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--viz-bg-secondary); background: var(--viz-bg); color: var(--viz-text-main); font-family: 'Consolas', monospace; }
        .input-row button { padding: 8px 16px; background: var(--viz-primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">åƒé¦™è•‰çš„ç‚ç‚ï¼ˆBINARY SEARCH ON ANSWERï¼‰</div>
                <div class="piles" id="pilesDisplay"></div>
                <div class="speed-test" id="speedTest"></div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                    <button class="viz-btn play-btn" id="playBtn" onclick="viz.toggleAutoPlay()">â–¶ è‡ªå‹•æ’­æ”¾</button>
                    <div class="speed-control">
                        <label>é€Ÿåº¦:</label>
                        <select id="speedSelect" onchange="viz.setSpeed(Number(this.value))">
                            <option value="2000">0.5x</option>
                            <option value="1500" selected>1x</option>
                            <option value="1000">1.5x</option>
                            <option value="500">2x</option>
                        </select>
                    </div>
                </div>
                <div class="complexity-badge">
                    <span class="label">Time:</span> O(n log m)
                    <span class="label" style="margin-left: 12px;">Space:</span> O(1)
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">æ™‚é™ h</div><div class="state-value" id="hDisplay">8</div></div>
                    <div class="state-item"><div class="state-label">L / k / R</div><div class="state-value" id="lmrDisplay">-</div></div>
                    <div class="state-item"><div class="state-label">æœ€å° k</div><div class="state-value" id="resultDisplay" style="color: var(--viz-success);">?</div></div>
                </div>
                <div class="legend">
                    <div class="legend-item"><div class="legend-color" style="background: var(--viz-warning);"></div>é¦™è•‰å †</div>
                </div>
                <div class="custom-input-section">
                    <div class="input-title">ğŸ® è‡ªè¨‚æ¸¬è©¦</div>
                    <div class="input-row">
                        <label>å †:</label>
                        <input type="text" id="customPiles" placeholder="é¦™è•‰å †" value="3,6,7,11">
                    </div>
                    <div class="input-row">
                        <label>h:</label>
                        <input type="number" id="customH" value="8" style="width: 60px;">
                        <button onclick="runCustomInput()">åŸ·è¡Œ</button>
                    </div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">æ¼”ç®—æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'int minEatingSpeed(vector<int>& piles, int h) {', id: 0 },
            { line: '    int l = 1, r = *max_element(piles.begin(), piles.end());', id: 1 },
            { line: '    while (l < r) {', id: 2 },
            { line: '        int k = l + (r - l) / 2;', id: 3 },
            { line: '        int hours = 0;', id: 4 },
            { line: '        for (int p : piles)', id: 5 },
            { line: '            hours += (p + k - 1) / k;  // ceil(p/k)', id: 6 },
            { line: '        if (hours <= h)', id: 7 },
            { line: '            r = k;     // å¯ä»¥æ›´æ…¢', id: 8 },
            { line: '        else', id: 9 },
            { line: '            l = k + 1; // éœ€è¦æ›´å¿«', id: 10 },
            { line: '    }', id: 11 },
            { line: '    return l;', id: 12 },
            { line: '}', id: 13 },
        ];
        let currentPiles = [3, 6, 7, 11];
        let currentH = 8;
        function calcHours(piles, k) { return piles.reduce((sum, p) => sum + Math.ceil(p / k), 0); }
        function generateAlgorithmSteps(piles, h) {
            const steps = [];
            let l = 1, r = Math.max(...piles);
            steps.push({ l, r, k: Math.floor((l + r) / 2), hours: calcHours(piles, Math.floor((l + r) / 2)), highlightLines: [0,1,2,3,4,5,6], explanation: { title: 'åˆå§‹åŒ–', text: `é¦™è•‰å †ï¼š[${piles.join(', ')}]<br>æ™‚é™ï¼š${h} å°æ™‚<br><br>äºŒåˆ†æœå°‹åƒçš„é€Ÿåº¦ k<br>l=1, r=${r}ï¼ˆæœ€å¤§å †ï¼‰`, formula: `hours = Î£ ceil(pile[i] / k)` } });
            while (l < r) {
                const k = Math.floor((l + r) / 2);
                const hours = calcHours(piles, k);
                if (hours <= h) {
                    steps.push({ l, r, k, hours, highlightLines: [7,8], explanation: { title: `k=${k} å¯è¡Œ âœ“`, text: `éœ€è¦ ${hours} å°æ™‚ â‰¤ ${h}<br>å¯ä»¥å˜—è©¦æ›´æ…¢<br>r = k = ${k}`, formula: `${piles.map(p => `âŒˆ${p}/${k}âŒ‰`).join('+')} = ${hours} â‰¤ ${h}` } });
                    r = k;
                } else {
                    steps.push({ l, r, k, hours, highlightLines: [9,10], explanation: { title: `k=${k} å¤ªæ…¢ âœ—`, text: `éœ€è¦ ${hours} å°æ™‚ > ${h}<br>éœ€è¦æ›´å¿«<br>l = k + 1 = ${k + 1}`, formula: `${piles.map(p => `âŒˆ${p}/${k}âŒ‰`).join('+')} = ${hours} > ${h}` } });
                    l = k + 1;
                }
            }
            steps.push({ l, r, k: l, hours: calcHours(piles, l), result: l, highlightLines: [12], explanation: { title: 'ğŸ‰ æ‰¾åˆ°ç­”æ¡ˆï¼', text: `æœ€å°é€Ÿåº¦ k = ${l}<br>éœ€è¦ ${calcHours(piles, l)} å°æ™‚`, formula: `return ${l}` } });
            return steps;
        }
        let viz;
        function init(piles = currentPiles, h = currentH) {
            currentPiles = piles; currentH = h;
            document.getElementById('hDisplay').textContent = h;
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    const maxP = Math.max(...currentPiles);
                    document.getElementById('pilesDisplay').innerHTML = currentPiles.map((p, i) => {
                        const ht = (p / maxP) * 100;
                        return `<div class="pile"><div class="pile-bar" style="height:${ht}px">${p}</div><div class="pile-label">å †${i+1}</div></div>`;
                    }).join('');
                    document.getElementById('speedTest').innerHTML = `<div class="k">k = ${step.k ?? '-'}</div><div class="hours">éœ€è¦ ${step.hours ?? '-'} å°æ™‚${step.hours !== undefined ? (step.hours <= currentH ? ' âœ“' : ' âœ—') : ''}</div>`;
                    document.getElementById('lmrDisplay').textContent = `${step.l} / ${step.k ?? '-'} / ${step.r}`;
                    document.getElementById('resultDisplay').textContent = step.result ?? '?';
                }
            });
            viz.setSteps(generateAlgorithmSteps(currentPiles, currentH));
        }
        function runCustomInput() {
            const piles = document.getElementById('customPiles').value.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n) && n > 0);
            const h = parseInt(document.getElementById('customH').value);
            if (piles.length < 1 || piles.length > 8) { alert('è«‹è¼¸å…¥ 1-8 å€‹æ­£æ•´æ•¸'); return; }
            if (isNaN(h) || h < piles.length) { alert(`h å¿…é ˆ >= ${piles.length}ï¼ˆé¦™è•‰å †æ•¸é‡ï¼‰`); return; }
            init(piles, h);
        }
        function resetVisualization() { init(currentPiles, currentH); }
        window.addEventListener('load', () => init());
    </script>
</body>
</html>
