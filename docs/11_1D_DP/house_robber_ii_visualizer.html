<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>House Robber II - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .custom-input-section { background: var(--viz-card-bg); border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--viz-border); }
        .input-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 8px; }
        .input-row input { padding: 8px 12px; border-radius: 6px; border: 1px solid var(--viz-border); background: var(--viz-input-bg); color: var(--viz-text); font-family: monospace; }
        .input-row button { padding: 8px 16px; border-radius: 6px; background: var(--viz-primary); color: white; border: none; cursor: pointer; }

        .houses { display: flex; gap: 10px; justify-content: center; margin: 20px 0; flex-wrap: wrap; padding: 10px; }
        .house { 
            width: 50px; height: 60px; display: flex; flex-direction: column; align-items: center; justify-content: center; 
            border-radius: 6px; background: var(--viz-bg-secondary); border: 2px solid var(--viz-border); transition: all 0.3s;
            position: relative;
        }
        .house.active { border-color: var(--viz-primary); transform: scale(1.1); }
        .house.robbed { background: var(--viz-success); border-color: var(--viz-success); color: #0f172a; }
        .house.locked { background: var(--viz-error); opacity: 0.3; pointer-events: none; }
        .house-val { font-weight: bold; font-size: 1.1rem; }
        .house-idx { font-size: 0.7rem; opacity: 0.7; }

        .case-block { 
            background: rgba(255, 255, 255, 0.05); border-radius: 8px; padding: 10px; margin-bottom: 10px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .case-title { font-weight: bold; width: 150px; }
        .case-val { font-family: monospace; font-size: 1.2rem; color: var(--viz-accent); }

        .circle-indicator { text-align: center; color: var(--viz-warning); margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">æ‰“å®¶åŠ«èˆ II (Circular House Robber)</div>
                <div class="custom-input-section">
                    <div style="font-weight:bold; margin-bottom:5px;">ğŸ® è‡ªè¨‚æ¸¬è©¦</div>
                    <div class="input-row">
                        <label>è²¡ç‰© (nums):</label>
                        <input type="text" id="numsInput" value="2, 3, 2" style="width: 200px;">
                        <button onclick="runCustomInput()">åŸ·è¡Œ</button>
                    </div>
                </div>

                <div class="circle-indicator">âŸ² ç’°å½¢æˆ¿å±‹ï¼šä¸èƒ½åŒæ™‚æ¶ç¬¬ä¸€å’Œæœ€å¾Œ</div>
                
                <div class="houses" id="housesDisplay"></div>
                
                <div style="margin-top: 20px;">
                    <div class="case-block" id="case1Block">
                        <div class="case-title">Case 1: ä¸æ¶æœ€å¾Œ</div>
                        <div class="case-val" id="case1Display">-</div>
                    </div>
                    <div class="case-block" id="case2Block">
                        <div class="case-title">Case 2: ä¸æ¶ç¬¬ä¸€</div>
                        <div class="case-val" id="case2Display">-</div>
                    </div>
                </div>

                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                    <div class="speed-control">
                        <label>é€Ÿåº¦:</label>
                        <select id="speedSelect" onchange="viz.setSpeed(Number(this.value))">
                            <option value="1500">1x</option>
                            <option value="500">2x</option>
                        </select>
                    </div>
                </div>

                <div class="complexity-badge">
                    <span class="label">Time:</span> O(n)
                    <span class="label" style="margin-left: 12px;">Space:</span> O(1)
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">æœ€å¤§æ”¶ç›Š</div><div class="state-value" id="resultDisplay">-</div></div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">æ¼”ç®—æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'int rob(vector<int>& nums) {', id: 0 },
            { line: '    int n = nums.size();', id: 1 },
            { line: '    if (n == 1) return nums[0];', id: 2 },
            { line: '    // ç’°å½¢æ¢ä»¶ï¼šæ‹†è§£ç‚ºå…©å€‹ç·šæ€§å•é¡Œ', id: 3 },
            { line: '    return max(', id: 4 },
            { line: '        robRange(nums, 0, n - 2), // Case 1: å¿½ç•¥æœ€å¾Œ', id: 5 },
            { line: '        robRange(nums, 1, n - 1)  // Case 2: å¿½ç•¥ç¬¬ä¸€', id: 6 },
            { line: '    );', id: 7 },
            { line: '}', id: 8 },
            { line: 'int robRange(nums, start, end) {', id: 9 },
            { line: '    // ç·šæ€§ DP é‚è¼¯', id: 10 },
            { line: '    // ...', id: 11 },
            { line: '}', id: 12 },
        ];

        let currentNums = [2, 3, 2];

        function runCustomInput() {
            const str = document.getElementById('numsInput').value;
            const arr = str.split(',').map(x => parseInt(x.trim())).filter(x => !isNaN(x));
            if (arr.length < 1 || arr.length > 10) {
                alert('è«‹è¼¸å…¥ 1-10 å€‹æ•¸å­—');
                return;
            }
            currentNums = arr;
            init();
        }

        // Helper for linear rob
        function linearRob(nums, start, end) {
            let prev = 0, curr = 0;
            const history = []; // To visualize steps inside linear
            for (let i = start; i <= end; i++) {
                let temp = Math.max(curr, prev + nums[i]);
                history.push({ idx: i, val: temp, rob: temp > curr }); 
                prev = curr;
                curr = temp;
            }
            return { total: curr, steps: history };
        }

        function generateAlgorithmSteps(nums) {
            const steps = [];
            const n = nums.length;
            
            steps.push({
                hl: [0, 1, 2, 3],
                expl: { title: 'åˆå§‹åŒ–', text: `Nums: [${nums.join(', ')}]<br>æº–å‚™æ‹†è§£ç’°å½¢å•é¡Œ`, formula: 'setup' }
            });

            if (n === 1) {
                steps.push({
                    result: nums[0],
                    hl: [2],
                    expl: { title: 'å”¯ä¸€æˆ¿å±‹', text: 'ç›´æ¥æ¶åŠ«', formula: `return ${nums[0]}` }
                });
                return steps;
            }

            // Case 1
            const case1Res = linearRob(nums, 0, n-2);
            for (let s of case1Res.steps) {
                steps.push({
                    case: 1,
                    idx: s.idx,
                    runningVal: s.val,
                    start: 0, end: n-2,
                    hl: [5],
                    expl: { title: 'Case 1: å¿½ç•¥æœ€å¾Œ', text: `æª¢æŸ¥æˆ¿ ${s.idx}<br>ç•¶å‰ç´¯ç©æœ€å¤§: ${s.val}`, formula: `robRange(0, ${n-2})` }
                });
            }
            steps.push({
                case: 1, done: true, val: case1Res.total,
                start: 0, end: n-2,
                hl: [5],
                expl: { title: 'Case 1 å®Œæˆ', text: `ç¯„åœ [0, ${n-2}] æœ€å¤§æ”¶ç›Š: ${case1Res.total}`, formula: `res1 = ${case1Res.total}` }
            });

            // Case 2
            const case2Res = linearRob(nums, 1, n-1);
            for (let s of case2Res.steps) {
                 steps.push({
                    case: 2,
                    idx: s.idx,
                    runningVal: s.val,
                    case1Val: case1Res.total,
                    start: 1, end: n-1,
                    hl: [6],
                    expl: { title: 'Case 2: å¿½ç•¥ç¬¬ä¸€', text: `æª¢æŸ¥æˆ¿ ${s.idx}<br>ç•¶å‰ç´¯ç©æœ€å¤§: ${s.val}`, formula: `robRange(1, ${n-1})` }
                });
            }
            steps.push({
                case: 2, done: true, val: case2Res.total,
                case1Val: case1Res.total,
                start: 1, end: n-1,
                hl: [6],
                expl: { title: 'Case 2 å®Œæˆ', text: `ç¯„åœ [1, ${n-1}] æœ€å¤§æ”¶ç›Š: ${case2Res.total}`, formula: `res2 = ${case2Res.total}` }
            });

            // Final
            const finalRes = Math.max(case1Res.total, case2Res.total);
            steps.push({
                result: finalRes,
                case1Val: case1Res.total,
                case2Val: case2Res.total,
                hl: [7, 8],
                expl: { title: 'æ¯”è¼ƒçµæœ', text: `Max(${case1Res.total}, ${case2Res.total}) = ${finalRes}`, formula: `return ${finalRes}` }
            });

            return steps;
        }

        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    // Update Value displays
                    const c1Disp = document.getElementById('case1Display');
                    const c2Disp = document.getElementById('case2Display');
                    
                    if (step.case === 1) {
                        c1Disp.textContent = step.done ? step.val : step.runningVal;
                    } else if (step.case1Val !== undefined) {
                        c1Disp.textContent = step.case1Val;
                    }

                    if (step.case === 2) {
                        c2Disp.textContent = step.done ? step.val : step.runningVal;
                    } else if (step.case2Val !== undefined) {
                        c2Disp.textContent = step.case2Val;
                    }
                    
                    document.getElementById('resultDisplay').textContent = step.result !== undefined ? step.result : '-';

                    // Update Houses
                    const container = document.getElementById('housesDisplay');
                    container.innerHTML = '';
                    currentNums.forEach((val, i) => {
                        let cls = 'house';
                        // Logic to show valid range
                        if (step.start !== undefined) {
                            if (i < step.start || i > step.end) cls += ' locked';
                        }
                        
                        if (step.idx === i) cls += ' active';
                        
                        const div = document.createElement('div');
                        div.className = cls;
                        div.innerHTML = `<span class="house-val">${val}</span><span class="house-idx">${i}</span>`;
                        container.appendChild(div);
                    });
                    
                    // Highlight active case block
                    document.getElementById('case1Block').style.borderColor = step.case === 1 ? 'var(--viz-primary)' : 'transparent';
                    document.getElementById('case2Block').style.borderColor = step.case === 2 ? 'var(--viz-primary)' : 'transparent';
                }
            });
            viz.setSteps(generateAlgorithmSteps(currentNums));
        }

        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
