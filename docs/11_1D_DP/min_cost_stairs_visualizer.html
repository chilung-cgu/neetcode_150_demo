<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Min Cost Climbing Stairs - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .custom-input-section { background: var(--viz-card-bg); border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--viz-border); }
        .input-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 8px; }
        .input-row input { padding: 8px 12px; border-radius: 6px; border: 1px solid var(--viz-border); background: var(--viz-input-bg); color: var(--viz-text); font-family: monospace; }
        .input-row button { padding: 8px 16px; border-radius: 6px; background: var(--viz-primary); color: white; border: none; cursor: pointer; }

        .stairs-viz { 
            display: flex; align-items: flex-end; justify-content: center; gap: 4px;
            height: 250px; margin: 20px 0; overflow-x: auto; padding-bottom: 30px;
        }
        .stair-col { display: flex; flex-direction: column; align-items: center; justify-content: flex-end; width: 50px; position: relative; }
        .stair-block { 
            width: 100%; border-radius: 4px 4px 0 0; background: var(--viz-bg-secondary); border: 2px solid var(--viz-border);
            display: flex; align-items: flex-start; justify-content: center; padding-top: 5px;
            font-weight: bold; color: var(--viz-text-muted); transition: all 0.3s;
        }
        .stair-block.active { background: var(--viz-primary); border-color: white; color: white; }
        .stair-block.top { border-color: var(--viz-success); background: rgba(34, 197, 94, 0.2); }
        
        .cost-bubble {
            background: var(--viz-warning); color: #0f172a; padding: 2px 6px; border-radius: 10px; font-size: 0.8rem; font-weight: bold;
            margin-bottom: 4px; opacity: 0; transition: opacity 0.3s;
        }
        .total-bubble {
            background: var(--viz-success); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.9rem; font-weight: bold;
            position: absolute; bottom: -30px; min-width: 40px; text-align: center;
        }

        .dp-row { display: flex; justify-content: center; gap: 4px; margin-top: 20px; }
        .dp-cell { 
            width: 50px; height: 50px; border: 1px solid var(--viz-border); display: flex; align-items: center; justify-content: center;
            background: var(--viz-bg-secondary); border-radius: 4px; font-weight: bold; font-family: monospace;
        }
        .dp-cell.highlight { border-color: var(--viz-success); background: rgba(34, 197, 94, 0.1); }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">æœ€å°èŠ±è²»çˆ¬æ¨“æ¢¯ (Min Cost)</div>
                <div class="custom-input-section">
                    <div style="font-weight:bold; margin-bottom:5px;">ğŸ® è‡ªè¨‚æ¸¬è©¦</div>
                    <div class="input-row">
                        <label>Cost é™£åˆ—:</label>
                        <input type="text" id="costInput" value="10, 15, 20" style="width: 200px;">
                        <button onclick="runCustomInput()">åŸ·è¡Œ</button>
                    </div>
                </div>
                
                <div class="stairs-viz" id="stairsDisplay"></div>
                <div style="text-align: center; font-weight: bold;">DP State (Min cost to reach index i)</div>
                <div class="dp-row" id="dpDisplay"></div>
                
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                    <div class="speed-control">
                        <label>é€Ÿåº¦:</label>
                        <select id="speedSelect" onchange="viz.setSpeed(Number(this.value))">
                            <option value="1500">1x</option>
                            <option value="500">2x</option>
                        </select>
                    </div>
                </div>
                
                <div class="complexity-badge">
                    <span class="label">Time:</span> O(n)
                    <span class="label" style="margin-left: 12px;">Space:</span> O(n)
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">æœ€å°ç¸½èŠ±è²»</div><div class="state-value" id="resultDisplay">-</div></div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">æ¼”ç®—æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'int minCostClimbingStairs(vector<int>& cost) {', id: 0 },
            { line: '    int n = cost.size();', id: 1 },
            { line: '    vector<int> dp(n + 1);', id: 2 },
            { line: '    dp[0] = 0; dp[1] = 0;', id: 3 },
            { line: '    for (int i = 2; i <= n; i++) {', id: 4 },
            { line: '        dp[i] = min(dp[i-1] + cost[i-1],', id: 5 },
            { line: '                    dp[i-2] + cost[i-2]);', id: 6 },
            { line: '    }', id: 7 },
            { line: '    return dp[n];', id: 8 },
            { line: '}', id: 9 },
        ];

        let currentCost = [10, 15, 20];

        function runCustomInput() {
            const str = document.getElementById('costInput').value;
            const arr = str.split(',').map(x => parseInt(x.trim())).filter(x => !isNaN(x));
            if (arr.length < 2 || arr.length > 10) {
                alert('è«‹è¼¸å…¥ 2-10 å€‹æ•¸å­—');
                return;
            }
            currentCost = arr;
            init();
        }

        function generateAlgorithmSteps(cost) {
            const steps = [];
            const n = cost.length;
            const dp = new Array(n + 1).fill(null);
            
            steps.push({
                idx: -1, dp: [...dp], 
                highlightLines: [0, 1, 2],
                explanation: { title: 'åˆå§‹åŒ–', text: `Cost: [${cost.join(', ')}]<br>DP è¡¨é•·åº¦ ${n+1}`, formula: 'setup' }
            });

            dp[0] = 0;
            dp[1] = 0; // Can start at 0 or 1 for free
            steps.push({
                idx: 1, dp: [...dp], 
                highlightLines: [3],
                explanation: { title: 'èµ·é»é¸æ“‡', text: 'å¯ä»¥å¾ index 0 æˆ– index 1 é–‹å§‹ï¼Œåˆå§‹èŠ±è²»ç‚º 0', formula: 'dp[0]=0, dp[1]=0' }
            });

            for (let i = 2; i <= n; i++) {
                const takeOne = dp[i-1] + cost[i-1];
                const takeTwo = dp[i-2] + cost[i-2];
                const best = Math.min(takeOne, takeTwo);
                
                // Show thinking
                steps.push({
                    idx: i, dp: [...dp], calculating: true,
                    vals: {one: takeOne, two: takeTwo},
                    highlightLines: [4, 5, 6],
                    explanation: { 
                        title: `è¨ˆç®—åˆ°é” Step ${i}`, 
                        text: `é¸é … 1 (å¾ i-1): ${dp[i-1]} + ${cost[i-1]} = ${takeOne}<br>é¸é … 2 (å¾ i-2): ${dp[i-2]} + ${cost[i-2]} = ${takeTwo}`, 
                        formula: `min(${takeOne}, ${takeTwo})` 
                    }
                });

                dp[i] = best;
                steps.push({
                    idx: i, dp: [...dp],
                    highlightLines: [5],
                    explanation: { title: `Step ${i} çµæœ`, text: `æœ€å°èŠ±è²»ç‚º ${best}`, formula: `dp[${i}] = ${best}` }
                });
            }

            steps.push({
                idx: n, dp: [...dp], result: dp[n], final: true,
                highlightLines: [8],
                explanation: { title: 'å®Œæˆ', text: `åˆ°é”é ‚å±¤çš„æœ€å°èŠ±è²»ç‚º ${dp[n]}`, formula: `return ${dp[n]}` }
            });

            return steps;
        }

        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    const n = currentCost.length;
                    
                    // Stairs Render
                    const container = document.getElementById('stairsDisplay');
                    container.innerHTML = '';
                    
                    // We render n steps + Top
                    for (let i = 0; i <= n; i++) {
                        const h = 50 + (i * 15);
                        let cls = 'stair-block';
                        if (i === n) cls += ' top';
                        else if (i === step.idx) cls += ' active';
                        
                        const col = document.createElement('div');
                        col.className = 'stair-col';
                        
                        // Cost bubble above block
                        if (i < n) {
                             const bubble = document.createElement('div');
                             bubble.className = 'cost-bubble';
                             bubble.textContent = `Cost: ${currentCost[i]}`;
                             bubble.style.opacity = 0.8;
                             col.appendChild(bubble);
                        }

                        const block = document.createElement('div');
                        block.className = cls;
                        block.style.height = `${h}px`;
                        block.textContent = i === n ? 'TOP' : i;
                        col.appendChild(block);
                        
                        // Total bubble below
                        if (step.dp[i] !== null) {
                            const total = document.createElement('div');
                            total.className = 'total-bubble';
                            total.textContent = step.dp[i];
                            col.appendChild(total);
                        }
                        
                        container.appendChild(col);
                    }
                    
                    // DP Table Render
                    const dpRow = document.getElementById('dpDisplay');
                    dpRow.innerHTML = step.dp.map((val, i) => {
                        let cls = 'dp-cell';
                        if (i === step.idx) cls += ' highlight';
                        return `<div class="${cls}">${val === null ? '' : val}</div>`;
                    }).join('');
                    
                    document.getElementById('resultDisplay').textContent = step.result !== undefined ? step.result : '-';
                }
            });
            viz.setSteps(generateAlgorithmSteps(currentCost));
        }

        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
