<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insert Interval æ’å…¥å€é–“ - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .intervals { display: flex; flex-direction: column; gap: 8px; margin: 15px 0; }
        .interval-row { display: flex; align-items: center; gap: 10px; }
        .interval { padding: 8px 16px; border-radius: 6px; background: var(--viz-primary); color: white; font-weight: bold; transition: all 0.3s; }
        .interval.new { background: var(--viz-secondary); color: #0f172a; }
        .interval.merge { background: var(--viz-warning); color: #0f172a; }
        .interval.result { background: var(--viz-success); color: #0f172a; }
        .interval.current { border: 3px solid var(--viz-error); }
        .timeline { display: flex; height: 40px; background: var(--viz-bg-secondary); border-radius: 6px; margin: 15px 0; position: relative; }
        .time-block { position: absolute; height: 100%; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; color: white; }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">æ’å…¥å€é–“ï¼ˆINSERT INTERVALï¼‰</div>
                <div class="timeline" id="timeline"></div>
                <div class="intervals" id="intervalsDisplay"></div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                    <button class="viz-btn play-btn" id="playBtn" onclick="viz.toggleAutoPlay()">â–¶ è‡ªå‹•æ’­æ”¾</button>
                    <div class="speed-control">
                        <label>é€Ÿåº¦:</label>
                        <select id="speedSelect" onchange="viz.setSpeed(Number(this.value))">
                            <option value="2000">0.5x</option>
                            <option value="1500" selected>1x</option>
                            <option value="1000">1.5x</option>
                            <option value="500">2x</option>
                        </select>
                    </div>
                </div>
                
                <div class="complexity-badge">
                    <span class="label">Time:</span> O(n)
                    <span class="label" style="margin-left: 12px;">Space:</span> O(n)
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">æ–°å€é–“</div><div class="state-value" id="newDisplay">[2, 5]</div></div>
                <div class="legend">
                    <div class="legend-item"><div class="legend-color normal"></div>ä¸€èˆ¬</div>
                    <div class="legend-item"><div class="legend-color current"></div>ç›®å‰è™•ç†</div>
                    <div class="legend-item"><div class="legend-color in-stack"></div>åœ¨å †ç–Šä¸­</div>
                </div>
                    <div class="state-item"><div class="state-label">çµæœæ•¸é‡</div><div class="state-value" id="resultDisplay" style="color: var(--viz-success);">?</div></div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">æ¼”ç®—æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'vector<vector<int>> insert(vector<vector<int>>& intervals,', id: 0 },
            { line: '                           vector<int>& newInterval) {', id: 1 },
            { line: '    vector<vector<int>> result;', id: 2 },
            { line: '    int i = 0, n = intervals.size();', id: 3 },
            { line: '    // 1. åŠ å…¥æ‰€æœ‰çµæŸåœ¨æ–°å€é–“é–‹å§‹ä¹‹å‰çš„', id: 4 },
            { line: '    while (i < n && intervals[i][1] < newInterval[0])', id: 5 },
            { line: '        result.push_back(intervals[i++]);', id: 6 },
            { line: '    // 2. åˆä½µé‡ç–Šå€é–“', id: 7 },
            { line: '    while (i < n && intervals[i][0] <= newInterval[1]) {', id: 8 },
            { line: '        newInterval[0] = min(newInterval[0], intervals[i][0]);', id: 9 },
            { line: '        newInterval[1] = max(newInterval[1], intervals[i][1]);', id: 10 },
            { line: '        i++;', id: 11 },
            { line: '    }', id: 12 },
            { line: '    result.push_back(newInterval);', id: 13 },
            { line: '    // 3. åŠ å…¥å‰©é¤˜å€é–“', id: 14 },
            { line: '    while (i < n) result.push_back(intervals[i++]);', id: 15 },
            { line: '    return result;', id: 16 },
            { line: '}', id: 17 },
        ];
        const intervals = [[1,3],[6,9]];
        const newInterval = [2,5];
        function generateAlgorithmSteps() {
            const steps = [];
            steps.push({ intervals: [[1,3],[6,9]], newInterval: [2,5], result: [], highlightLines: [0,1,2,3], explanation: { title: 'åˆå§‹åŒ–', text: `åŸå€é–“ï¼š[[1,3], [6,9]]<br>æ–°å€é–“ï¼š[2,5]<br><br>ä¸‰éšæ®µè™•ç†ï¼šå‰ã€åˆä½µã€å¾Œ` } });
            steps.push({ intervals: [[1,3],[6,9]], newInterval: [2,5], current: 0, result: [], highlightLines: [4,5,6], explanation: { title: 'éšæ®µä¸€ï¼šæª¢æŸ¥ [1,3]', text: '[1,3] çµæŸæ–¼ 3<br>æ–°å€é–“é–‹å§‹æ–¼ 2<br>3 â‰® 2ï¼Œæ‰€ä»¥æœ‰é‡ç–Šï¼' } });
            steps.push({ intervals: [[1,3],[6,9]], newInterval: [1,5], current: 0, merge: true, result: [], highlightLines: [7,8,9,10,11], explanation: { title: 'åˆä½µ [1,3] å’Œ [2,5]', text: 'min(2,1)=1, max(5,3)=5<br>æ–°å€é–“æ›´æ–°ç‚º [1,5]', formula: 'merge â†’ [min(2,1), max(5,3)] = [1,5]' } });
            steps.push({ intervals: [[1,3],[6,9]], newInterval: [1,5], current: 1, result: [], highlightLines: [8], explanation: { title: 'æª¢æŸ¥ [6,9]', text: '[6,9] é–‹å§‹æ–¼ 6<br>æ–°å€é–“çµæŸæ–¼ 5<br>6 > 5ï¼Œç„¡é‡ç–Šï¼' } });
            steps.push({ intervals: [[1,3],[6,9]], newInterval: [1,5], result: [[1,5]], highlightLines: [13], explanation: { title: 'åŠ å…¥åˆä½µå¾Œçš„å€é–“', text: 'å°‡ [1,5] åŠ å…¥çµæœ' } });
            steps.push({ intervals: [[1,3],[6,9]], newInterval: [1,5], result: [[1,5],[6,9]], highlightLines: [14,15], explanation: { title: 'åŠ å…¥å‰©é¤˜å€é–“', text: 'å°‡ [6,9] åŠ å…¥çµæœ' } });
            steps.push({ intervals: [[1,3],[6,9]], newInterval: [1,5], result: [[1,5],[6,9]], final: true, highlightLines: [16], explanation: { title: 'å®Œæˆï¼', text: 'çµæœï¼š[[1,5], [6,9]]<br><br>æ™‚é–“è¤‡é›œåº¦ï¼šO(n)<br>ç©ºé–“è¤‡é›œåº¦ï¼šO(n)' } });
            return steps;
        }
        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    let html = '<div class="interval-row"><span style="width:60px;color:var(--text-muted)">åŸå§‹:</span>';
                    (step.intervals || []).forEach((iv, i) => {
                        let cls = 'interval';
                        if (step.current === i) cls += ' current';
                        if (step.merge && step.current === i) cls += ' merge';
                        html += `<div class="${cls}">[${iv[0]}, ${iv[1]}]</div>`;
                    });
                    html += '</div><div class="interval-row"><span style="width:60px;color:var(--text-muted)">æ–°:</span>';
                    html += `<div class="interval new">[${step.newInterval?.[0] ?? 2}, ${step.newInterval?.[1] ?? 5}]</div></div>`;
                    if (step.result?.length > 0) {
                        html += '<div class="interval-row"><span style="width:60px;color:var(--text-muted)">çµæœ:</span>';
                        step.result.forEach(iv => html += `<div class="interval result">[${iv[0]}, ${iv[1]}]</div>`);
                        html += '</div>';
                    }
                    document.getElementById('intervalsDisplay').innerHTML = html;
                    document.getElementById('newDisplay').textContent = `[${step.newInterval?.[0] ?? 2}, ${step.newInterval?.[1] ?? 5}]`;
                    document.getElementById('resultDisplay').textContent = step.result?.length ?? '?';
                }
            });
            viz.setSteps(generateAlgorithmSteps());
        }
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
