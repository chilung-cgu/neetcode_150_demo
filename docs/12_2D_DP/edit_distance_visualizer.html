<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Distance - Ë¶ñË¶∫Âåñ</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .custom-input-section { background: var(--viz-card-bg); border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--viz-border); }
        .input-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 8px; }
        .input-row input { padding: 8px 12px; border-radius: 6px; border: 1px solid var(--viz-border); background: var(--viz-input-bg); color: var(--viz-text); font-family: monospace; }
        .input-row button { padding: 8px 16px; border-radius: 6px; background: var(--viz-primary); color: white; border: none; cursor: pointer; }

        .strings { display: flex; gap: 30px; justify-content: center; margin: 15px 0; flex-wrap: wrap; }
        .string-box { text-align: center; }
        .string-label { color: var(--viz-text-muted); margin-bottom: 5px; font-size: 0.9rem; }
        .chars { display: flex; gap: 4px; }
        .char { width: 30px; height: 35px; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 4px; background: var(--viz-bg-secondary); font-family: monospace; }
        .char.match { background: var(--viz-success); color: #0f172a; }

        .dp-scroll { overflow: auto; padding: 10px; display: flex; justify-content: center; }
        .dp-table { display: inline-grid; gap: 2px; }
        .dp-cell { width: 32px; height: 28px; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 3px; background: var(--viz-bg-secondary); font-size: 0.85rem; transition: all 0.2s; }
        .dp-cell.header { background: var(--viz-primary); color: white; }
        .dp-cell.current { background: var(--viz-warning); color: #0f172a; box-shadow: 0 0 8px rgba(234, 179, 8, 0.5); }
        .dp-cell.match { background: var(--viz-success); color: #0f172a; }
        .dp-cell.min-source { border: 2px solid var(--viz-warning); }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="ÂàáÊèõ‰∏ªÈ°å">üåì</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">Á∑®ËºØË∑ùÈõ¢ (Edit Distance)</div>
                <div class="custom-input-section">
                    <div style="font-weight:bold; margin-bottom:5px;">üéÆ Ëá™Ë®ÇÊ∏¨Ë©¶</div>
                    <div class="input-row">
                        <label>word1:</label>
                        <input type="text" id="w1Input" value="horse" style="width: 100px;" maxlength="8">
                        <label>word2:</label>
                        <input type="text" id="w2Input" value="ros" style="width: 100px;" maxlength="8">
                        <button onclick="runCustomInput()">Âü∑Ë°å</button>
                    </div>
                </div>
                
                <div class="strings">
                    <div class="string-box"><div class="string-label">word1</div><div class="chars" id="word1Display"></div></div>
                    <div class="string-box"><div class="string-label">word2</div><div class="chars" id="word2Display"></div></div>
                </div>
                
                <div class="dp-scroll">
                    <div class="dp-table" id="dpTable"></div>
                </div>

                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">‚Üê ‰∏ä‰∏ÄÊ≠•</button>
                    <div class="step-indicator">Ê≠•È©ü <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">‰∏ã‰∏ÄÊ≠• ‚Üí</button>
                    <button class="viz-btn" onclick="resetVisualization()">‚Üª ÈáçÁΩÆ</button>
                    <div class="speed-control">
                        <label>ÈÄüÂ∫¶:</label>
                        <select id="speedSelect" onchange="viz.setSpeed(Number(this.value))">
                            <option value="1500">1x</option>
                            <option value="500">2x</option>
                        </select>
                    </div>
                </div>
                
                <div class="complexity-badge">
                    <span class="label">Time:</span> O(m¬∑n)
                    <span class="label" style="margin-left: 12px;">Space:</span> O(m¬∑n)
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">Á∑®ËºØË∑ùÈõ¢</div><div class="state-value" id="resultDisplay">-</div></div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">ÊºîÁÆóÊ≥ïË™™Êòé</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">ÊºîÁÆóÊ≥ï (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'int minDistance(string w1, string w2) {', id: 0 },
            { line: '    int m = w1.size(), n = w2.size();', id: 1 },
            { line: '    vector<vector<int>> dp(m+1, vector<int>(n+1));', id: 2 },
            { line: '    for (int i = 0; i <= m; i++) dp[i][0] = i;', id: 3 },
            { line: '    for (int j = 0; j <= n; j++) dp[0][j] = j;', id: 4 },
            { line: '    for (int i = 1; i <= m; i++) {', id: 5 },
            { line: '        for (int j = 1; j <= n; j++) {', id: 6 },
            { line: '            if (w1[i-1] == w2[j-1])', id: 7 },
            { line: '                dp[i][j] = dp[i-1][j-1];', id: 8 },
            { line: '            else', id: 9 },
            { line: '                dp[i][j] = 1 + min({dp[i-1][j], dp[i][j-1], dp[i-1][j-1]});', id: 10 },
            { line: '        }', id: 11 },
            { line: '    }', id: 12 },
            { line: '    return dp[m][n];', id: 13 },
            { line: '}', id: 14 },
        ];
        
        let w1 = "horse", w2 = "ros";

        function runCustomInput() {
            const s1 = document.getElementById('w1Input').value.trim();
            const s2 = document.getElementById('w2Input').value.trim();
            if (!s1 || !s2 || s1.length > 8 || s2.length > 8) {
                alert('Ë´ãËº∏ÂÖ• 1-8 ÂÄãÂ≠óÂÖÉ');
                return;
            }
            w1 = s1;
            w2 = s2;
            init();
        }

        function generateAlgorithmSteps(word1, word2) {
            const steps = [];
            const m = word1.length, n = word2.length;
            const dp = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));

            // Init
            for (let i = 0; i <= m; i++) dp[i][0] = i;
            for (let j = 0; j <= n; j++) dp[0][j] = j;

            steps.push({
                dp: dp.map(r => [...r]), i: -1, j: -1,
                highlightLines: [0, 1, 2, 3, 4],
                explanation: { title: 'ÂàùÂßãÂåñ', text: `w1="${word1}", w2="${word2}"<br>ÈÇäÁïå: dp[i][0]=i, dp[0][j]=j`, formula: 'setup' }
            });

            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    const c1 = word1[i - 1], c2 = word2[j - 1];
                    const isMatch = c1 === c2;
                    
                    if (isMatch) {
                        dp[i][j] = dp[i - 1][j - 1];
                        steps.push({
                            dp: dp.map(r => [...r]), i, j, match: true, 
                            charMatch: { i1: i-1, i2: j-1 },
                            highlightLines: [7, 8],
                            explanation: { 
                                title: `ÂåπÈÖç: '${c1}' == '${c2}'`, 
                                text: `‰∏çÈúÄÁ∑®ËºØ<br>dp[${i}][${j}] = dp[${i-1}][${j-1}] = ${dp[i][j]}`,
                                formula: `dp[${i}][${j}] = ${dp[i-1][j-1]}`
                            }
                        });
                    } else {
                        const del = dp[i - 1][j];
                        const ins = dp[i][j - 1];
                        const rep = dp[i - 1][j - 1];
                        dp[i][j] = 1 + Math.min(del, ins, rep);
                        
                        let op = '';
                        if (dp[i][j] === 1 + del) op = 'Âà™Èô§';
                        else if (dp[i][j] === 1 + ins) op = 'ÊèíÂÖ•';
                        else op = 'ÊõøÊèõ';
                        
                        steps.push({
                            dp: dp.map(r => [...r]), i, j, match: false,
                            highlightLines: [9, 10],
                            explanation: { 
                                title: `‰∏çÂåπÈÖç: '${c1}' != '${c2}'`, 
                                text: `ÈÅ∏Êìá ${op}<br>dp[${i}][${j}] = 1 + min(${del}, ${ins}, ${rep}) = ${dp[i][j]}`,
                                formula: `1 + min(${del}, ${ins}, ${rep}) = ${dp[i][j]}`
                            }
                        });
                    }
                }
            }

            steps.push({
                dp: dp.map(r => [...r]), result: dp[m][n], final: true,
                highlightLines: [13],
                explanation: { title: 'ÂÆåÊàê', text: `Á∑®ËºØË∑ùÈõ¢: ${dp[m][n]}`, formula: `return ${dp[m][n]}` }
            });

            return steps;
        }

        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    // Strings
                    document.getElementById('word1Display').innerHTML = w1.split('').map((c, idx) => {
                        let cls = 'char';
                        if (step.charMatch && step.charMatch.i1 === idx) cls += ' match';
                        return `<div class="${cls}">${c}</div>`;
                    }).join('');
                    document.getElementById('word2Display').innerHTML = w2.split('').map((c, idx) => {
                        let cls = 'char';
                        if (step.charMatch && step.charMatch.i2 === idx) cls += ' match';
                        return `<div class="${cls}">${c}</div>`;
                    }).join('');

                    // DP Table
                    const m = w1.length, n = w2.length;
                    const grid = document.getElementById('dpTable');
                    grid.style.gridTemplateColumns = `repeat(${n + 2}, 32px)`;
                    
                    let html = '<div class="dp-cell header"></div>';
                    html += '<div class="dp-cell header">""</div>';
                    for (let j = 0; j < n; j++) html += `<div class="dp-cell header">${w2[j]}</div>`;
                    
                    html += '<div class="dp-cell header">""</div>';
                    for (let j = 0; j <= n; j++) {
                        let cls = 'dp-cell';
                        if (step.i === 0 && step.j === j) cls += ' current';
                        html += `<div class="${cls}">${step.dp?.[0]?.[j] ?? 0}</div>`;
                    }

                    for (let i = 1; i <= m; i++) {
                        html += `<div class="dp-cell header">${w1[i - 1]}</div>`;
                        for (let j = 0; j <= n; j++) {
                            let cls = 'dp-cell';
                            if (step.i === i && step.j === j) cls += step.match ? ' match' : ' current';
                            html += `<div class="${cls}">${step.dp?.[i]?.[j] ?? 0}</div>`;
                        }
                    }
                    grid.innerHTML = html;
                    
                    document.getElementById('resultDisplay').textContent = step.result !== undefined ? step.result : '-';
                }
            });
            viz.setSteps(generateAlgorithmSteps(w1, w2));
        }
        
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
