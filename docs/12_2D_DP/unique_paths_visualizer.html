<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unique Paths ä¸åŒè·¯å¾‘ - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .custom-input-section { background: var(--viz-card-bg); border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--viz-border); }
        .input-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 8px; }
        .input-row input { padding: 8px 12px; border-radius: 6px; border: 1px solid var(--viz-border); background: var(--viz-input-bg); color: var(--viz-text); font-family: monospace; width: 60px; }
        .input-row button { padding: 8px 16px; border-radius: 6px; background: var(--viz-primary); color: white; border: none; cursor: pointer; }

        .grid-container { overflow: auto; padding: 10px; display: flex; justify-content: center; }
        .grid { display: inline-grid; gap: 2px; background: var(--viz-bg-secondary); padding: 10px; border-radius: 8px; }
        .cell { 
            width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;
            background: var(--viz-card-bg); color: var(--viz-text); border-radius: 4px;
            font-weight: bold; font-size: 1rem; transition: all 0.3s ease; border: 2px solid transparent;
        }
        .cell.start { background: linear-gradient(135deg, var(--viz-success), var(--viz-secondary)); color: #0f172a; }
        .cell.end { background: linear-gradient(135deg, var(--viz-warning), var(--viz-error)); color: #0f172a; }
        .cell.current { border-color: var(--viz-primary); background: var(--viz-primary); color: white; transform: scale(1.05); }
        .cell.from-top { border-color: var(--viz-warning); }
        .cell.from-left { border-color: var(--viz-success); }
        .cell.filled { background: rgba(34, 197, 94, 0.15); }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">ä¸åŒè·¯å¾‘ (Unique Paths)</div>
                <div class="custom-input-section">
                    <div style="font-weight:bold; margin-bottom:5px;">ğŸ® è‡ªè¨‚æ¸¬è©¦</div>
                    <div class="input-row">
                        <label>è¡Œ (m):</label>
                        <input type="number" id="mInput" value="3" min="1" max="7">
                        <label>åˆ— (n):</label>
                        <input type="number" id="nInput" value="4" min="1" max="7">
                        <button onclick="runCustomInput()">åŸ·è¡Œ</button>
                    </div>
                </div>
                
                <div class="grid-container">
                    <div class="grid" id="gridDisplay"></div>
                </div>

                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                    <div class="speed-control">
                        <label>é€Ÿåº¦:</label>
                        <select id="speedSelect" onchange="viz.setSpeed(Number(this.value))">
                            <option value="1500">1x</option>
                            <option value="500">2x</option>
                        </select>
                    </div>
                </div>
                
                <div class="complexity-badge">
                    <span class="label">Time:</span> O(mÂ·n)
                    <span class="label" style="margin-left: 12px;">Space:</span> O(mÂ·n)
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">ç­”æ¡ˆ</div><div class="state-value" id="answerDisplay">-</div></div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">æ¼”ç®—æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'int uniquePaths(int m, int n) {', id: 0 },
            { line: '    vector<vector<int>> dp(m, vector<int>(n, 1));', id: 1 },
            { line: '    for (int i = 1; i < m; i++) {', id: 2 },
            { line: '        for (int j = 1; j < n; j++) {', id: 3 },
            { line: '            dp[i][j] = dp[i-1][j] + dp[i][j-1];', id: 4 },
            { line: '        }', id: 5 },
            { line: '    }', id: 6 },
            { line: '    return dp[m-1][n-1];', id: 7 },
            { line: '}', id: 8 },
        ];
        
        let currentM = 3, currentN = 4;

        function runCustomInput() {
            const m = parseInt(document.getElementById('mInput').value);
            const n = parseInt(document.getElementById('nInput').value);
            if (m < 1 || m > 7 || n < 1 || n > 7) {
                alert('è¡Œèˆ‡åˆ—è«‹è¼¸å…¥ 1-7');
                return;
            }
            currentM = m;
            currentN = n;
            init();
        }

        function generateAlgorithmSteps(m, n) {
            const steps = [];
            const dp = Array.from({ length: m }, () => Array(n).fill(0));
            
            // Init first row and column
            for (let i = 0; i < m; i++) dp[i][0] = 1;
            for (let j = 0; j < n; j++) dp[0][j] = 1;

            steps.push({
                dp: dp.map(r => [...r]), pos: null,
                highlightLines: [0, 1],
                explanation: { title: 'åˆå§‹åŒ–', text: `ç¶²æ ¼ ${m}Ã—${n}<br>ç¬¬ä¸€è¡Œ/åˆ—åªæœ‰ 1 ç¨®è·¯å¾‘`, formula: 'dp[0][*] = dp[*][0] = 1' }
            });

            // Fill DP
            for (let i = 1; i < m; i++) {
                for (let j = 1; j < n; j++) {
                    const fromTop = dp[i - 1][j];
                    const fromLeft = dp[i][j - 1];
                    dp[i][j] = fromTop + fromLeft;
                    
                    steps.push({
                        dp: dp.map(r => [...r]), 
                        pos: [i, j], fromTopPos: [i-1, j], fromLeftPos: [i, j-1],
                        highlightLines: [2, 3, 4],
                        explanation: { 
                            title: `è¨ˆç®— dp[${i}][${j}]`, 
                            text: `å¾ä¸Š (${i-1},${j}): ${fromTop}<br>å¾å·¦ (${i},${j-1}): ${fromLeft}<br>ç¸½è¨ˆ: ${dp[i][j]}`,
                            formula: `dp[${i}][${j}] = ${fromTop} + ${fromLeft} = ${dp[i][j]}`
                        }
                    });
                }
            }

            steps.push({
                dp: dp.map(r => [...r]), pos: [m-1, n-1], answer: dp[m-1][n-1], final: true,
                highlightLines: [7],
                explanation: { title: 'å®Œæˆ', text: `å…±æœ‰ ${dp[m-1][n-1]} ç¨®ä¸åŒè·¯å¾‘`, formula: `return ${dp[m-1][n-1]}` }
            });

            return steps;
        }

        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    const grid = document.getElementById('gridDisplay');
                    const m = currentM, n = currentN;
                    grid.style.gridTemplateColumns = `repeat(${n}, 50px)`;
                    
                    let html = '';
                    for (let i = 0; i < m; i++) {
                        for (let j = 0; j < n; j++) {
                            let cls = 'cell';
                            const val = step.dp?.[i]?.[j] ?? 0;
                            
                            if (i === 0 && j === 0) cls += ' start';
                            else if (i === m - 1 && j === n - 1) cls += ' end';
                            else if (step.pos?.[0] === i && step.pos?.[1] === j) cls += ' current';
                            else if (val > 0) cls += ' filled';
                            
                            // Highlight source cells
                            if (step.fromTopPos && step.fromTopPos[0] === i && step.fromTopPos[1] === j) cls += ' from-top';
                            if (step.fromLeftPos && step.fromLeftPos[0] === i && step.fromLeftPos[1] === j) cls += ' from-left';
                            
                            const content = i === 0 && j === 0 ? 'ğŸ¤–' : (val || '-');
                            html += `<div class="${cls}">${content}</div>`;
                        }
                    }
                    grid.innerHTML = html;
                    
                    document.getElementById('answerDisplay').textContent = step.answer ?? '-';
                }
            });
            viz.setSteps(generateAlgorithmSteps(currentM, currentN));
        }
        
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
