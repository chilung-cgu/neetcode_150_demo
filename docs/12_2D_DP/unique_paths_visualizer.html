<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unique Paths ä¸åŒè·¯å¾‘ - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .grid { display: inline-grid; gap: 2px; margin: 15px auto; background: var(--viz-bg-secondary); padding: 10px; border-radius: 8px; }
        .cell { 
            width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;
            background: var(--viz-primary); color: white; border-radius: 4px;
            font-weight: bold; font-size: 1.1rem; transition: all 0.3s ease;
        }
        .cell.current { background: var(--viz-secondary); color: #0f172a; }
        .cell.filled { background: var(--viz-success); color: #0f172a; }
        .cell.start { background: linear-gradient(135deg, var(--viz-success), var(--viz-secondary)); }
        .cell.end { background: linear-gradient(135deg, var(--viz-warning), var(--viz-error)); }
        .cell.border { background: rgba(100, 116, 139, 0.3); color: var(--text-muted); }
        .robot { font-size: 1.5rem; }
    </style>
</head>
<body>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">ä¸åŒè·¯å¾‘ï¼ˆUNIQUE PATHSï¼‰</div>
                <div style="text-align: center;">
                    <div class="grid" id="gridDisplay"></div>
                </div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                </div>
                <div class="state-grid">
                    <div class="state-item">
                        <div class="state-label">ç›®å‰ä½ç½®</div>
                        <div class="state-value" id="posDisplay">(0, 0)</div>
                    </div>
                    <div class="state-item">
                        <div class="state-label">ç•¶å‰æ ¼å­è·¯å¾‘æ•¸</div>
                        <div class="state-value" id="valueDisplay" style="color: var(--viz-success);">1</div>
                    </div>
                    <div class="state-item">
                        <div class="state-label">ç­”æ¡ˆ</div>
                        <div class="state-value" id="answerDisplay">?</div>
                    </div>
                </div>
            </div>
            <div class="viz-card">
                <div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div>
                <div class="explanation" id="explanation"></div>
            </div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%; box-sizing: border-box;">
                <div class="viz-title">å‹•æ…‹è¦åŠƒ (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'int uniquePaths(int m, int n) {', id: 0 },
            { line: '    vector<vector<int>> dp(m, vector<int>(n, 1));', id: 1 },
            { line: '    // ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—éƒ½æ˜¯ 1ï¼ˆåªæœ‰ä¸€ç¨®èµ°æ³•ï¼‰', id: 2 },
            { line: '', id: 3 },
            { line: '    for (int i = 1; i < m; i++) {', id: 4 },
            { line: '        for (int j = 1; j < n; j++) {', id: 5 },
            { line: '            // åˆ°é” (i,j) çš„è·¯å¾‘ = å¾ä¸Šæ–¹ + å¾å·¦æ–¹', id: 6 },
            { line: '            dp[i][j] = dp[i-1][j] + dp[i][j-1];', id: 7 },
            { line: '        }', id: 8 },
            { line: '    }', id: 9 },
            { line: '    return dp[m-1][n-1];', id: 10 },
            { line: '}', id: 11 },
        ];
        
        const m = 3, n = 4; // 3x4 ç¶²æ ¼

        function generateAlgorithmSteps() {
            const steps = [];
            const dp = Array.from({ length: m }, () => Array(n).fill(0));
            
            // åˆå§‹åŒ–
            steps.push({
                dp: dp.map(r => [...r]),
                pos: null,
                highlightLines: [0, 1, 2],
                explanation: { 
                    title: 'åˆå§‹åŒ– DP è¡¨æ ¼', 
                    text: `ç¶²æ ¼å¤§å°ï¼š${m} Ã— ${n}<br><br>æ©Ÿå™¨äººå¾å·¦ä¸Šè§’ (0,0) å‡ºç™¼ï¼Œåªèƒ½<strong>å‘å³</strong>æˆ–<strong>å‘ä¸‹</strong>ç§»å‹•ã€‚<br><br>å•é¡Œï¼šåˆ°é”å³ä¸‹è§’ (${m-1},${n-1}) æœ‰å¹¾ç¨®ä¸åŒè·¯å¾‘ï¼Ÿ` 
                }
            });
            
            // åˆå§‹åŒ–ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—ç‚º 1
            for (let i = 0; i < m; i++) dp[i][0] = 1;
            for (let j = 0; j < n; j++) dp[0][j] = 1;
            
            steps.push({
                dp: dp.map(r => [...r]),
                pos: null,
                filledCells: [...Array(m).keys()].map(i => [i, 0]).concat([...Array(n).keys()].map(j => [0, j])),
                highlightLines: [1, 2],
                explanation: { 
                    title: 'é‚Šç•Œæ¢ä»¶', 
                    text: `ç¬¬ä¸€è¡Œï¼šåªèƒ½ä¸€è·¯å‘å³ï¼Œåªæœ‰ 1 ç¨®èµ°æ³•<br>ç¬¬ä¸€åˆ—ï¼šåªèƒ½ä¸€è·¯å‘ä¸‹ï¼Œåªæœ‰ 1 ç¨®èµ°æ³•<br><br>æ‰€ä»¥ dp[0][j] = dp[i][0] = 1` 
                }
            });
            
            // å¡«å…… DP è¡¨æ ¼
            for (let i = 1; i < m; i++) {
                for (let j = 1; j < n; j++) {
                    const fromTop = dp[i - 1][j];
                    const fromLeft = dp[i][j - 1];
                    dp[i][j] = fromTop + fromLeft;
                    
                    steps.push({
                        dp: dp.map(r => [...r]),
                        pos: [i, j],
                        fromTop: [i - 1, j],
                        fromLeft: [i, j - 1],
                        highlightLines: [4, 5, 6, 7],
                        explanation: { 
                            title: `è¨ˆç®— dp[${i}][${j}]`, 
                            text: `åˆ°é” (${i}, ${j}) åªèƒ½å¾<strong>ä¸Šæ–¹</strong>æˆ–<strong>å·¦æ–¹</strong>ä¾†ï¼š<br><br>å¾ä¸Šæ–¹ (${i - 1}, ${j})ï¼š${fromTop} ç¨®è·¯å¾‘<br>å¾å·¦æ–¹ (${i}, ${j - 1})ï¼š${fromLeft} ç¨®è·¯å¾‘<br><br>ç¸½è¨ˆï¼š${fromTop} + ${fromLeft} = ${dp[i][j]} ç¨®`,
                            formula: `dp[${i}][${j}] = dp[${i - 1}][${j}] + dp[${i}][${j - 1}] = ${fromTop} + ${fromLeft} = ${dp[i][j]}`
                        }
                    });
                }
            }
            
            steps.push({
                dp: dp.map(r => [...r]),
                pos: [m - 1, n - 1],
                answer: dp[m - 1][n - 1],
                highlightLines: [10],
                explanation: { 
                    title: 'æ¼”ç®—æ³•å®Œæˆï¼', 
                    text: `å¾ (0,0) åˆ° (${m - 1},${n - 1}) å…±æœ‰ <strong>${dp[m - 1][n - 1]}</strong> ç¨®ä¸åŒè·¯å¾‘ã€‚<br><br>æ™‚é–“è¤‡é›œåº¦ï¼šO(m Ã— n)<br>ç©ºé–“è¤‡é›œåº¦ï¼šO(m Ã— n)ï¼Œå¯å„ªåŒ–è‡³ O(n)` 
                }
            });
            
            return steps;
        }

        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    const grid = document.getElementById('gridDisplay');
                    grid.style.gridTemplateColumns = `repeat(${n}, 50px)`;
                    
                    let html = '';
                    for (let i = 0; i < m; i++) {
                        for (let j = 0; j < n; j++) {
                            let cls = 'cell';
                            const val = step.dp?.[i]?.[j] ?? 0;
                            
                            if (i === 0 && j === 0) cls += ' start';
                            else if (i === m - 1 && j === n - 1) cls += ' end';
                            else if (step.pos?.[0] === i && step.pos?.[1] === j) cls += ' current';
                            else if (val > 0) cls += ' filled';
                            
                            const content = i === 0 && j === 0 ? 'ğŸ¤–' : (val || '-');
                            html += `<div class="${cls}">${content}</div>`;
                        }
                    }
                    grid.innerHTML = html;
                    
                    document.getElementById('posDisplay').textContent = step.pos ? `(${step.pos[0]}, ${step.pos[1]})` : '-';
                    document.getElementById('valueDisplay').textContent = step.pos ? (step.dp?.[step.pos[0]]?.[step.pos[1]] ?? '-') : '-';
                    document.getElementById('answerDisplay').textContent = step.answer ?? '?';
                }
            });
            viz.setSteps(generateAlgorithmSteps());
        }
        
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
