<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Longest Common Subsequence - Ë¶ñË¶∫Âåñ</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .custom-input-section { background: var(--viz-card-bg); border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--viz-border); }
        .input-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 8px; }
        .input-row input { padding: 8px 12px; border-radius: 6px; border: 1px solid var(--viz-border); background: var(--viz-input-bg); color: var(--viz-text); font-family: monospace; }
        .input-row button { padding: 8px 16px; border-radius: 6px; background: var(--viz-primary); color: white; border: none; cursor: pointer; }

        .strings { display: flex; gap: 30px; justify-content: center; margin: 15px 0; flex-wrap: wrap; }
        .string-box { text-align: center; }
        .string-label { color: var(--viz-text-muted); margin-bottom: 5px; font-size: 0.9rem; }
        .chars { display: flex; gap: 4px; }
        .char { width: 30px; height: 35px; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 4px; background: var(--viz-bg-secondary); font-family: monospace; }
        .char.match { background: var(--viz-success); color: #0f172a; }

        .dp-scroll { overflow: auto; padding: 10px; display: flex; justify-content: center; }
        .dp-table { display: inline-grid; gap: 2px; }
        .dp-cell { width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 4px; background: var(--viz-bg-secondary); transition: all 0.3s; font-size: 0.9rem; }
        .dp-cell.header { background: var(--viz-primary); color: white; font-size: 0.9rem; }
        .dp-cell.current { background: var(--viz-warning); color: #0f172a; box-shadow: 0 0 10px rgba(234, 179, 8, 0.5); }
        .dp-cell.match { background: var(--viz-success); color: #0f172a; }
        .dp-cell.diag { border: 2px solid var(--viz-warning); }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="ÂàáÊèõ‰∏ªÈ°å">üåì</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">ÊúÄÈï∑ÂÖ¨ÂÖ±Â≠êÂ∫èÂàó (LCS)</div>
                <div class="custom-input-section">
                    <div style="font-weight:bold; margin-bottom:5px;">üéÆ Ëá™Ë®ÇÊ∏¨Ë©¶</div>
                    <div class="input-row">
                        <label>text1:</label>
                        <input type="text" id="t1Input" value="ace" style="width: 100px;" maxlength="8">
                        <label>text2:</label>
                        <input type="text" id="t2Input" value="abcde" style="width: 100px;" maxlength="8">
                        <button onclick="runCustomInput()">Âü∑Ë°å</button>
                    </div>
                </div>
                
                <div class="strings">
                    <div class="string-box"><div class="string-label">text1</div><div class="chars" id="text1Display"></div></div>
                    <div class="string-box"><div class="string-label">text2</div><div class="chars" id="text2Display"></div></div>
                </div>
                
                <div class="dp-scroll">
                    <div class="dp-table" id="dpTable"></div>
                </div>

                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">‚Üê ‰∏ä‰∏ÄÊ≠•</button>
                    <div class="step-indicator">Ê≠•È©ü <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">‰∏ã‰∏ÄÊ≠• ‚Üí</button>
                    <button class="viz-btn" onclick="resetVisualization()">‚Üª ÈáçÁΩÆ</button>
                    <div class="speed-control">
                        <label>ÈÄüÂ∫¶:</label>
                        <select id="speedSelect" onchange="viz.setSpeed(Number(this.value))">
                            <option value="1500">1x</option>
                            <option value="500">2x</option>
                        </select>
                    </div>
                </div>
                
                <div class="complexity-badge">
                    <span class="label">Time:</span> O(m¬∑n)
                    <span class="label" style="margin-left: 12px;">Space:</span> O(m¬∑n)
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">LCS Èï∑Â∫¶</div><div class="state-value" id="lcsDisplay">-</div></div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">ÊºîÁÆóÊ≥ïË™™Êòé</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">ÊºîÁÆóÊ≥ï (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'int longestCommonSubsequence(string t1, string t2) {', id: 0 },
            { line: '    int m = t1.size(), n = t2.size();', id: 1 },
            { line: '    vector<vector<int>> dp(m+1, vector<int>(n+1, 0));', id: 2 },
            { line: '    for (int i = 1; i <= m; i++) {', id: 3 },
            { line: '        for (int j = 1; j <= n; j++) {', id: 4 },
            { line: '            if (t1[i-1] == t2[j-1])', id: 5 },
            { line: '                dp[i][j] = dp[i-1][j-1] + 1;', id: 6 },
            { line: '            else', id: 7 },
            { line: '                dp[i][j] = max(dp[i-1][j], dp[i][j-1]);', id: 8 },
            { line: '        }', id: 9 },
            { line: '    }', id: 10 },
            { line: '    return dp[m][n];', id: 11 },
            { line: '}', id: 12 },
        ];
        
        let t1 = "ace", t2 = "abcde";

        function runCustomInput() {
            const s1 = document.getElementById('t1Input').value.trim();
            const s2 = document.getElementById('t2Input').value.trim();
            if (!s1 || !s2 || s1.length > 8 || s2.length > 8) {
                alert('Ë´ãËº∏ÂÖ• 1-8 ÂÄãÂ≠óÂÖÉ');
                return;
            }
            t1 = s1;
            t2 = s2;
            init();
        }

        function generateAlgorithmSteps(text1, text2) {
            const steps = [];
            const m = text1.length, n = text2.length;
            const dp = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));

            steps.push({
                dp: dp.map(r => [...r]), i: -1, j: -1,
                highlightLines: [0, 1, 2],
                explanation: { title: 'ÂàùÂßãÂåñ', text: `t1="${text1}", t2="${text2}"<br>dp[i][j] = LCS(t1[0..i-1], t2[0..j-1])`, formula: 'setup' }
            });

            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    const c1 = text1[i - 1], c2 = text2[j - 1];
                    const isMatch = c1 === c2;
                    
                    if (isMatch) {
                        dp[i][j] = dp[i - 1][j - 1] + 1;
                        steps.push({
                            dp: dp.map(r => [...r]), i, j, match: true, diag: [i-1, j-1],
                            charMatch: { i1: i-1, i2: j-1 },
                            highlightLines: [5, 6],
                            explanation: { 
                                title: `ÂåπÈÖç: '${c1}' == '${c2}'`, 
                                text: `dp[${i}][${j}] = dp[${i-1}][${j-1}] + 1 = ${dp[i][j]}`,
                                formula: `dp[${i}][${j}] = ${dp[i-1][j-1]} + 1 = ${dp[i][j]}`
                            }
                        });
                    } else {
                        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
                        steps.push({
                            dp: dp.map(r => [...r]), i, j, match: false,
                            highlightLines: [7, 8],
                            explanation: { 
                                title: `‰∏çÂåπÈÖç: '${c1}' != '${c2}'`, 
                                text: `dp[${i}][${j}] = max(dp[${i-1}][${j}], dp[${i}][${j-1}]) = ${dp[i][j]}`,
                                formula: `max(${dp[i-1][j]}, ${dp[i][j-1]}) = ${dp[i][j]}`
                            }
                        });
                    }
                }
            }

            steps.push({
                dp: dp.map(r => [...r]), lcs: dp[m][n], final: true,
                highlightLines: [11],
                explanation: { title: 'ÂÆåÊàê', text: `LCS Èï∑Â∫¶: ${dp[m][n]}`, formula: `return ${dp[m][n]}` }
            });

            return steps;
        }

        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    // Strings
                    document.getElementById('text1Display').innerHTML = t1.split('').map((c, idx) => {
                        let cls = 'char';
                        if (step.charMatch && step.charMatch.i1 === idx) cls += ' match';
                        return `<div class="${cls}">${c}</div>`;
                    }).join('');
                    document.getElementById('text2Display').innerHTML = t2.split('').map((c, idx) => {
                        let cls = 'char';
                        if (step.charMatch && step.charMatch.i2 === idx) cls += ' match';
                        return `<div class="${cls}">${c}</div>`;
                    }).join('');

                    // DP Table
                    const m = t1.length, n = t2.length;
                    const grid = document.getElementById('dpTable');
                    grid.style.gridTemplateColumns = `repeat(${n + 2}, 35px)`;
                    
                    let html = '<div class="dp-cell header"></div>';
                    html += '<div class="dp-cell header">""</div>';
                    for (let j = 0; j < n; j++) html += `<div class="dp-cell header">${t2[j]}</div>`;
                    
                    html += '<div class="dp-cell header">""</div>';
                    for (let j = 0; j <= n; j++) {
                        let cls = 'dp-cell';
                        if (step.i === 0 && step.j === j) cls += ' current';
                        html += `<div class="${cls}">0</div>`;
                    }

                    for (let i = 1; i <= m; i++) {
                        html += `<div class="dp-cell header">${t1[i - 1]}</div>`;
                        for (let j = 0; j <= n; j++) {
                            let cls = 'dp-cell';
                            if (step.i === i && step.j === j) cls += step.match ? ' match' : ' current';
                            if (step.diag && step.diag[0] === i && step.diag[1] === j) cls += ' diag';
                            html += `<div class="${cls}">${step.dp?.[i]?.[j] ?? 0}</div>`;
                        }
                    }
                    grid.innerHTML = html;
                    
                    document.getElementById('lcsDisplay').textContent = step.lcs ?? (step.dp?.[m]?.[n] ?? '-');
                }
            });
            viz.setSteps(generateAlgorithmSteps(t1, t2));
        }
        
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
