<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combination Sum çµ„åˆç¸½å’Œ - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .tree-container { margin: 15px 0; overflow-x: auto; }
        .tree { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .tree-level { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        .tree-node { 
            padding: 8px 12px; border-radius: 8px; background: var(--viz-bg-secondary); 
            border: 2px solid var(--viz-primary); color: var(--text-primary);
            font-size: 0.85rem; text-align: center; transition: all 0.3s ease;
        }
        .tree-node.current { border-color: var(--viz-secondary); background: var(--viz-secondary); color: #0f172a; }
        .tree-node.valid { border-color: var(--viz-success); background: var(--viz-success); color: #0f172a; }
        .tree-node.pruned { opacity: 0.3; border-color: var(--viz-error); }
        .candidates { display: flex; gap: 8px; justify-content: center; margin: 10px 0; }
        .candidate { padding: 8px 16px; border-radius: 6px; background: var(--viz-primary); color: white; font-weight: bold; }
        .candidate.used { background: var(--viz-success); color: #0f172a; }
        .path-display { text-align: center; margin: 10px 0; font-size: 1.1rem; color: var(--viz-secondary); }
        .results { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; margin-top: 10px; }
        .result-item { background: var(--viz-success); color: #0f172a; padding: 4px 10px; border-radius: 4px; font-size: 0.85rem; }
    </style>
</head>
<body>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">çµ„åˆç¸½å’Œï¼ˆCOMBINATION SUMï¼‰</div>
                <div class="candidates" id="candidatesDisplay"></div>
                <div class="path-display" id="pathDisplay">ç›®å‰è·¯å¾‘ï¼š[]</div>
                <div class="tree-container">
                    <div class="tree" id="treeDisplay"></div>
                </div>
                <div class="results" id="resultsDisplay"></div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                    <button class="viz-btn play-btn" id="playBtn" onclick="viz.toggleAutoPlay()">â–¶ è‡ªå‹•æ’­æ”¾</button>
                    <div class="speed-control">
                        <label>é€Ÿåº¦:</label>
                        <select id="speedSelect" onchange="viz.setSpeed(Number(this.value))">
                            <option value="2000">0.5x</option>
                            <option value="1500" selected>1x</option>
                            <option value="1000">1.5x</option>
                            <option value="500">2x</option>
                        </select>
                    </div>
                </div>
                <div class="state-grid">
                    <div class="state-item">
                        <div class="state-label">ç›®æ¨™å€¼</div>
                        <div class="state-value" id="targetDisplay">7</div>
                    </div>
                    <div class="state-item">
                        <div class="state-label">å‰©é¤˜</div>
                        <div class="state-value" id="remainDisplay">7</div>
                    </div>
                    <div class="state-item">
                        <div class="state-label">æ‰¾åˆ°çµ„åˆ</div>
                        <div class="state-value" id="foundDisplay" style="color: var(--viz-success);">0</div>
                    </div>
                </div>
            </div>
            <div class="viz-card">
                <div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div>
                <div class="explanation" id="explanation"></div>
            </div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%; box-sizing: border-box;">
                <div class="viz-title">å›æº¯æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'void backtrack(vector<int>& candidates, int target,', id: 0 },
            { line: '               int start, vector<int>& path,', id: 1 },
            { line: '               vector<vector<int>>& result) {', id: 2 },
            { line: '    if (target == 0) {', id: 3 },
            { line: '        result.push_back(path);', id: 4 },
            { line: '        return;', id: 5 },
            { line: '    }', id: 6 },
            { line: '    for (int i = start; i < candidates.size(); i++) {', id: 7 },
            { line: '        if (candidates[i] > target) break; // å‰ªæ', id: 8 },
            { line: '        path.push_back(candidates[i]);', id: 9 },
            { line: '        backtrack(candidates, target - candidates[i],', id: 10 },
            { line: '                  i, path, result);', id: 11 },
            { line: '        path.pop_back(); // å›æº¯', id: 12 },
            { line: '    }', id: 13 },
            { line: '}', id: 14 },
        ];
        
        const candidates = [2, 3, 6, 7];
        const target = 7;

        function generateAlgorithmSteps() {
            const steps = [];
            const results = [];
            
            steps.push({
                path: [],
                remain: target,
                results: [],
                tree: [],
                highlightLines: [0, 1, 2],
                explanation: { 
                    title: 'åˆå§‹åŒ–å›æº¯æœå°‹', 
                    text: `å€™é¸æ•¸å­—ï¼š[${candidates.join(', ')}]<br>ç›®æ¨™å€¼ï¼š${target}<br><br>ä½¿ç”¨å›æº¯æ³•æ¢ç´¢æ‰€æœ‰å¯èƒ½çš„çµ„åˆã€‚<br>æ¯å€‹æ•¸å­—å¯ä»¥<strong>é‡è¤‡ä½¿ç”¨</strong>ã€‚` 
                }
            });
            
            function backtrack(start, remain, path, depth) {
                if (remain === 0) {
                    results.push([...path]);
                    steps.push({
                        path: [...path],
                        remain: 0,
                        results: results.map(r => [...r]),
                        usedIdx: path.map((_, i) => candidates.indexOf(path[i])),
                        highlightLines: [3, 4, 5],
                        explanation: { 
                            title: 'ğŸ‰ æ‰¾åˆ°æœ‰æ•ˆçµ„åˆï¼', 
                            text: `è·¯å¾‘ [${path.join(', ')}] çš„ç¸½å’Œ = ${target}<br><br>åŠ å…¥çµæœé›†åˆã€‚`,
                            formula: `${path.join(' + ')} = ${target}`
                        }
                    });
                    return;
                }
                
                for (let i = start; i < candidates.length; i++) {
                    const num = candidates[i];
                    
                    if (num > remain) {
                        steps.push({
                            path: [...path],
                            remain,
                            results: results.map(r => [...r]),
                            pruneIdx: i,
                            highlightLines: [7, 8],
                            explanation: { 
                                title: 'âœ‚ï¸ å‰ªæ', 
                                text: `candidates[${i}] = ${num} > å‰©é¤˜ ${remain}<br><br>ç”±æ–¼é™£åˆ—å·²æ’åºï¼Œå¾Œé¢çš„æ•¸å­—æ›´å¤§ï¼Œç›´æ¥è·³å‡ºè¿´åœˆã€‚`,
                                formula: `${num} > ${remain} â†’ break`
                            }
                        });
                        break;
                    }
                    
                    path.push(num);
                    steps.push({
                        path: [...path],
                        remain: remain - num,
                        results: results.map(r => [...r]),
                        currentIdx: i,
                        highlightLines: [9, 10, 11],
                        explanation: { 
                            title: `é¸æ“‡ ${num}`, 
                            text: `å°‡ ${num} åŠ å…¥è·¯å¾‘ï¼š[${path.join(', ')}]<br>å‰©é¤˜ç›®æ¨™ï¼š${remain} - ${num} = ${remain - num}<br><br>ä¸‹æ¬¡å¾ index ${i} é–‹å§‹ï¼ˆå…è¨±é‡è¤‡é¸å–ï¼‰`,
                            formula: `target = ${remain} - ${num} = ${remain - num}`
                        }
                    });
                    
                    backtrack(i, remain - num, path, depth + 1);
                    
                    path.pop();
                    steps.push({
                        path: [...path],
                        remain,
                        results: results.map(r => [...r]),
                        highlightLines: [12],
                        explanation: { 
                            title: 'â†©ï¸ å›æº¯', 
                            text: `ç§»é™¤ ${num}ï¼Œæ¢å¾©è·¯å¾‘ç‚ºï¼š[${path.join(', ') || 'ç©º'}]<br><br>å˜—è©¦ä¸‹ä¸€å€‹å€™é¸æ•¸å­—ã€‚` 
                        }
                    });
                }
            }
            
            backtrack(0, target, [], 0);
            
            steps.push({
                path: [],
                remain: target,
                results: results.map(r => [...r]),
                highlightLines: [14],
                explanation: { 
                    title: 'æœå°‹å®Œæˆï¼', 
                    text: `å…±æ‰¾åˆ° ${results.length} å€‹æœ‰æ•ˆçµ„åˆï¼š<br><br>${results.map(r => `[${r.join(', ')}]`).join('<br>')}<br><br>æ™‚é–“è¤‡é›œåº¦ï¼šO(N^(T/M))ï¼ŒN=å€™é¸æ•¸ï¼ŒT=ç›®æ¨™ï¼ŒM=æœ€å°å€™é¸` 
                }
            });
            
            return steps;
        }

        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    document.getElementById('candidatesDisplay').innerHTML = candidates.map((c, i) => {
                        let cls = 'candidate';
                        if (step.currentIdx === i) cls += ' used';
                        if (step.pruneIdx === i) cls += ' pruned';
                        return `<div class="${cls}">${c}</div>`;
                    }).join('');
                    
                    document.getElementById('pathDisplay').textContent = `ç›®å‰è·¯å¾‘ï¼š[${step.path?.join(', ') || ''}]`;
                    document.getElementById('remainDisplay').textContent = step.remain ?? target;
                    document.getElementById('foundDisplay').textContent = step.results?.length ?? 0;
                    
                    document.getElementById('resultsDisplay').innerHTML = (step.results || []).map(r => 
                        `<span class="result-item">[${r.join(', ')}]</span>`
                    ).join('');
                }
            });
            viz.setSteps(generateAlgorithmSteps());
        }
        
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
