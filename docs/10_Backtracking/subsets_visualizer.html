<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subsets å­é›† - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .custom-input-section { background: var(--viz-card-bg); border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--viz-border); }
        .input-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 8px; }
        .input-row input { padding: 8px 12px; border-radius: 6px; border: 1px solid var(--viz-border); background: var(--viz-input-bg); color: var(--viz-text); font-family: monospace; }
        .input-row button { padding: 8px 16px; border-radius: 6px; background: var(--viz-primary); color: white; border: none; cursor: pointer; }

        .tree-container { margin: 15px 0; overflow-x: auto; text-align: center; }
        .tree-node { 
            display: inline-block; padding: 8px 12px; margin: 5px; border-radius: 6px; 
            background: var(--viz-bg-secondary); border: 2px solid var(--viz-border); 
            transition: all 0.3s;
        }
        .tree-node.active { border-color: var(--viz-primary); background: rgba(59, 130, 246, 0.1); }
        .tree-node.result { border-color: var(--viz-success); background: rgba(34, 197, 94, 0.1); }
        
        .nums-display { display: flex; gap: 8px; justify-content: center; margin-bottom: 20px; }
        .num-item { 
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; 
            border-radius: 50%; background: var(--viz-bg-secondary); font-weight: bold;
            transition: all 0.3s;
        }
        .num-item.included { background: var(--viz-success); color: #0f172a; transform: scale(1.1); }
        .num-item.excluded { background: var(--viz-error); opacity: 0.5; }
        .num-item.pending { border: 2px dashed var(--viz-primary); }
        
        .results-grid { 
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; 
            margin-top: 20px; padding: 10px; background: rgba(0,0,0,0.1); border-radius: 8px;
        }
        .subset-badge { 
            padding: 4px 8px; background: var(--viz-success); color: #0f172a; 
            border-radius: 4px; font-size: 0.9rem; font-family: monospace;
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">å­é›† (Backtracking/DFS)</div>
                <div class="custom-input-section">
                    <div style="font-weight:bold; margin-bottom:5px;">ğŸ® è‡ªè¨‚æ¸¬è©¦</div>
                    <div class="input-row">
                        <label>é™£åˆ— (nums):</label>
                        <input type="text" id="numsInput" value="1, 2, 3" style="width: 150px;" placeholder="1, 2, 3">
                        <button onclick="runCustomInput()">åŸ·è¡Œ</button>
                    </div>
                </div>
                
                <div class="nums-display" id="numsDisplay"></div>
                
                <div style="text-align: center; margin: 10px 0;">
                    <div style="color:var(--text-muted); font-size:0.9rem;">ç•¶å‰æ±ºç­–</div>
                    <div id="decisionDisplay" style="font-size:1.2rem; font-weight:bold; height: 30px;">-</div>
                </div>
                
                 <div style="text-align: center; margin: 10px 0;">
                    <div style="color:var(--text-muted); font-size:0.9rem;">ç•¶å‰å­é›† (Path)</div>
                    <div id="pathDisplay" style="font-size:1.2rem; height: 30px;">[]</div>
                </div>

                <div class="results-grid" id="resultsDisplay"></div>
                
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                    <div class="speed-control">
                        <label>é€Ÿåº¦:</label>
                        <select id="speedSelect" onchange="viz.setSpeed(Number(this.value))">
                            <option value="1500">1x</option>
                            <option value="500">2x</option>
                        </select>
                    </div>
                </div>
                
                <div class="complexity-badge">
                    <span class="label">Time:</span> O(n * 2^n)
                    <span class="label" style="margin-left: 12px;">Space:</span> O(n)
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">ç¸½å­é›†æ•¸</div><div class="state-value" id="totalCount">0</div></div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">æ¼”ç®—æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'vector<vector<int>> subsets(vector<int>& nums) {', id: 0 },
            { line: '    vector<vector<int>> result;', id: 1 },
            { line: '    vector<int> subset;', id: 2 },
            { line: '    dfs(0, nums, subset, result);', id: 3 },
            { line: '    return result;', id: 4 },
            { line: '}', id: 5 },
            { line: 'void dfs(int i, vector<int>& nums,', id: 6 },
            { line: '         vector<int>& subset, vector<...>& res) {', id: 7 },
            { line: '    if (i >= nums.size()) {', id: 8 },
            { line: '        res.push_back(subset);', id: 9 },
            { line: '        return;', id: 10 },
            { line: '    }', id: 11 },
            { line: '    // æ±ºç­– 1: åŒ…å« nums[i]', id: 12 },
            { line: '    subset.push_back(nums[i]);', id: 13 },
            { line: '    dfs(i + 1, nums, subset, res);', id: 14 },
            { line: '    // æ±ºç­– 2: ä¸åŒ…å« nums[i]', id: 15 },
            { line: '    subset.pop_back();', id: 16 },
            { line: '    dfs(i + 1, nums, subset, res);', id: 17 },
            { line: '}', id: 18 },
        ];

        let currentNums = [1, 2, 3];

        function parseNums(str) {
            return str.split(',').map(x => parseInt(x.trim())).filter(x => !isNaN(x));
        }

        function generateAlgorithmSteps(nums) {
            const steps = [];
            const result = [];
            
            steps.push({
                idx: 0, path: [], result: [], 
                status: 'init',
                highlightLines: [0, 1, 2, 3],
                explanation: { title: 'é–‹å§‹', text: `è¼¸å…¥: [${nums.join(', ')}]<br>åˆå§‹ç‹€æ…‹ï¼ši = 0, subset = []`, formula: 'dfs(0)' }
            });

            function dfs(i, currentPath) {
                if (i >= nums.length) {
                    result.push([...currentPath]);
                    steps.push({
                        idx: i, path: [...currentPath], result: [...result],
                        status: 'leaf',
                        highlightLines: [8, 9, 10],
                        explanation: { title: 'åˆ°é”è‘‰ç¯€é»', text: `ç´¢å¼• i=${i} è¶…å‡ºç¯„åœ<br>æ”¶é›†ç•¶å‰å­é›†: [${currentPath.join(', ')}]`, formula: 'result.push(subset)' }
                    });
                    return;
                }

                const num = nums[i];

                // Include
                currentPath.push(num);
                steps.push({
                    idx: i, path: [...currentPath], result: [...result],
                    status: 'include',
                    highlightLines: [12, 13, 14],
                    explanation: { title: `åŒ…å« ${num}`, text: `æ±ºç­–ï¼šé¸æ“‡åŠ å…¥ ${num}<br>éè¿´ dfs(${i+1})`, formula: `subset.push(${num})` }
                });
                
                dfs(i + 1, currentPath);

                // Exclude (Backtrack)
                currentPath.pop();
                steps.push({
                    idx: i, path: [...currentPath], result: [...result],
                    status: 'exclude',
                    highlightLines: [16, 17],
                    explanation: { title: `ä¸åŒ…å« ${num}`, text: `å›æº¯ï¼šç§»é™¤ ${num}<br>æ±ºç­–ï¼šè·³é ${num}<br>éè¿´ dfs(${i+1})`, formula: `subset.pop()` }
                });
                
                dfs(i + 1, currentPath);
            }

            dfs(0, []);
            
            steps.push({
                idx: null, path: [], result: [...result],
                status: 'done',
                highlightLines: [4],
                explanation: { title: 'å®Œæˆ', text: `å…±æ‰¾åˆ° ${result.length} å€‹å­é›†<br>Time Complexity: O(n * 2^n)`, formula: 'return result' }
            });

            return steps;
        }

        function runCustomInput() {
            const str = document.getElementById('numsInput').value;
            const arr = parseNums(str);
            if (arr.length === 0 || arr.length > 5) { // Limit size for visualization
                alert('è«‹è¼¸å…¥ 1-5 å€‹æ•¸å­— (ç‚ºäº†è¦–è¦ºåŒ–æ•ˆæœ)');
                return;
            }
            currentNums = arr;
            init();
        }

        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    // Update Nums with Include/Exclude status
                    document.getElementById('numsDisplay').innerHTML = currentNums.map((n, idx) => {
                         let cls = 'num-item';
                         if (step.idx === idx) cls += ' pending';
                         // Check if n is in current path
                         // Note: This logic assumes unique numbers for simple coloring, but general logic is robust
                         // Or we strictly use the step.idx concept
                         
                         // Visual logic: 
                         // If we are deep in recursion (idx > current index), status is unknown
                         // If we are at step.idx, we are deciding
                         // If we are past, we look at path
                         
                         if (idx < step.idx) {
                             // This element was already decided
                             // Since we don't track full history per element easily in this step object without bloat, 
                             // we check if it is in step.path. 
                             // Limitation: handling duplicates correctly requires index-based tracking, but for visual this is okay.
                             if (step.path.includes(n)) cls += ' included';
                             else cls += ' excluded';
                         } else if (idx === step.idx) {
                             if (step.status === 'include') cls += ' included';
                             else if (step.status === 'exclude') cls += ' excluded';
                             else cls += ' pending';
                         }
                         
                         return `<div class="${cls}">${n}</div>`;
                    }).join('');

                    document.getElementById('decisionDisplay').textContent = step.explanation.title;
                    document.getElementById('pathDisplay').textContent = `[${step.path ? step.path.join(', ') : ''}]`;
                    
                    document.getElementById('resultsDisplay').innerHTML = (step.result || []).map(sub => 
                        `<span class="subset-badge">[${sub.join(', ')}]</span>`
                    ).join('');
                    
                    document.getElementById('totalCount').textContent = step.result ? step.result.length : 0;
                }
            });
            viz.setSteps(generateAlgorithmSteps(currentNums));
        }

        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
