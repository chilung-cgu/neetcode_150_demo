<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palindrome Partitioning - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .custom-input-section { background: var(--viz-card-bg); border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--viz-border); }
        .input-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 8px; }
        .input-row input { padding: 8px 12px; border-radius: 6px; border: 1px solid var(--viz-border); background: var(--viz-input-bg); color: var(--viz-text); font-family: monospace; }
        .input-row button { padding: 8px 16px; border-radius: 6px; background: var(--viz-primary); color: white; border: none; cursor: pointer; }

        .str-container { display: flex; gap: 2px; justify-content: center; margin: 20px 0; }
        .char-box { 
            width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; 
            background: var(--viz-primary); color: white; border-radius: 4px; font-family: monospace; font-size: 1.1rem;
            position: relative; transition: all 0.3s;
        }
        .char-box.checked { border: 2px solid var(--viz-warning); }
        .char-box.palindrome { background: var(--viz-success); color: #0f172a; }
        
        .current-partition { display: flex; gap: 10px; justify-content: center; min-height: 40px; margin-bottom: 20px; }
        .part-item { padding: 6px 12px; background: var(--viz-secondary); color: #0f172a; border-radius: 4px; font-weight: bold; }
        
        .results-grid { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; max-height: 200px; overflow-y: auto; padding: 10px; background: rgba(0,0,0,0.1); border-radius: 8px; }
        .result-item { padding: 4px 10px; background: var(--viz-success); color: #0f172a; border-radius: 4px; font-family: monospace; }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">åˆ†å‰²å›æ–‡ä¸² (Backtracking)</div>
                <div class="custom-input-section">
                    <div style="font-weight:bold; margin-bottom:5px;">ğŸ® è‡ªè¨‚æ¸¬è©¦</div>
                    <div class="input-row">
                        <label>å­—ä¸² (s):</label>
                        <input type="text" id="strInput" value="aab" style="width: 120px;" maxlength="10">
                        <button onclick="runCustomInput()">åŸ·è¡Œ</button>
                    </div>
                </div>
                
                <div class="str-container" id="strDisplay"></div>
                
                <div style="text-align: center; color: var(--text-muted); margin-bottom: 5px;">ç•¶å‰è·¯å¾‘</div>
                <div class="current-partition" id="pathDisplay"></div>
                
                <div class="results-grid" id="resultsDisplay"></div>
                
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                    <div class="speed-control">
                        <label>é€Ÿåº¦:</label>
                        <select id="speedSelect" onchange="viz.setSpeed(Number(this.value))">
                            <option value="1500">1x</option>
                            <option value="500">2x</option>
                        </select>
                    </div>
                </div>
                
                <div class="complexity-badge">
                    <span class="label">Time:</span> O(N * 2^N)
                    <span class="label" style="margin-left: 12px;">Space:</span> O(N)
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">è§£æ•¸</div><div class="state-value" id="countDisplay">0</div></div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">æ¼”ç®—æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'void backtrack(s, start, path, result) {', id: 0 },
            { line: '    if (start == s.size()) {', id: 1 },
            { line: '        result.push_back(path); return;', id: 2 },
            { line: '    }', id: 3 },
            { line: '    for (int end = start; end < s.size(); end++) {', id: 4 },
            { line: '        if (isPalindrome(s, start, end)) {', id: 5 },
            { line: '            path.push_back(s.substr(start, end-start+1));', id: 6 },
            { line: '            backtrack(s, end + 1, path, result);', id: 7 },
            { line: '            path.pop_back();', id: 8 },
            { line: '        }', id: 9 },
            { line: '    }', id: 10 },
            { line: '}', id: 11 },
        ];

        let currentStr = "aab";

        function runCustomInput() {
            const s = document.getElementById('strInput').value.trim();
            if (!s || s.length > 8) {
                alert('è«‹è¼¸å…¥ 1-8 å€‹å­—å…ƒ');
                return;
            }
            currentStr = s;
            init();
        }

        function isPalindrome(s, start, end) {
            let l = start, r = end;
            while (l < r) {
                if (s[l] !== s[r]) return false;
                l++; r--;
            }
            return true;
        }

        function generateAlgorithmSteps(s) {
            const steps = [];
            const result = [];
            
            steps.push({
                path: [], startIdx: 0, result: [], checkRange: null, 
                highlightLines: [0],
                explanation: { title: 'åˆå§‹åŒ–', text: `Input: "${s}"<br>é–‹å§‹å›æº¯`, formula: 'backtrack(0)' }
            });

            function backtrack(start, path) {
                if (start === s.length) {
                    result.push([...path]);
                    steps.push({
                        path: [...path], startIdx: start, result: [...result], checkRange: null,
                        newFound: true,
                        highlightLines: [1, 2, 3],
                        explanation: { title: 'æ‰¾åˆ°åˆ†å‰²', text: `å·²è™•ç†å®Œæ‰€æœ‰å­—å…ƒ<br>åˆ†å‰²æ–¹æ¡ˆ: [${path.join(', ')}]`, formula: 'Found' }
                    });
                    return;
                }

                for (let end = start; end < s.length; end++) {
                    const substr = s.substring(start, end + 1);
                    const isPal = isPalindrome(s, start, end);
                    
                    steps.push({
                        path: [...path], startIdx: start, result: [...result], 
                        checkRange: [start, end], 
                        isPal: isPal,
                        highlightLines: [5],
                        explanation: { 
                            title: `æª¢æŸ¥å›æ–‡: "${substr}"`, 
                            text: `ç¯„åœ [${start}, ${end}]<br>${isPal ? 'âœ… æ˜¯å›æ–‡' : 'âŒ ä¸æ˜¯å›æ–‡'}`, 
                            formula: `isPalindrome(${start}, ${end})` 
                        }
                    });

                    if (isPal) {
                        path.push(substr);
                        steps.push({
                            path: [...path], startIdx: start, result: [...result], checkRange: [start, end],
                            highlightLines: [6, 7],
                            explanation: { title: `é¸æ“‡ "${substr}"`, text: `åŠ å…¥è·¯å¾‘<br>éè¿´è™•ç†å‰©é¤˜éƒ¨åˆ†`, formula: `backtrack(${end+1})` }
                        });
                        
                        backtrack(end + 1, path);
                        
                        path.pop();
                        steps.push({
                            path: [...path], startIdx: start, result: [...result], 
                            highlightLines: [8],
                            explanation: { title: 'å›æº¯', text: `ç§»é™¤ "${substr}"<br>å˜—è©¦æ›´é•·çš„å‰ç¶´`, formula: 'pop()' }
                        });
                    }
                }
            }

            backtrack(0, []);
            
            steps.push({
                path: [], startIdx: 0, result: [...result], checkRange: null,
                final: true,
                explanation: { title: 'å®Œæˆ', text: `å…±æ‰¾åˆ° ${result.length} ç¨®åˆ†å‰²æ–¹æ¡ˆ`, formula: 'Done' }
            });

            return steps;
        }

        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    document.getElementById('strDisplay').innerHTML = [...currentStr].map((c, i) => {
                        let cls = 'char-box';
                        if (step.checkRange && i >= step.checkRange[0] && i <= step.checkRange[1]) {
                             cls += ' checked';
                             if (step.isPal) cls += ' palindrome'; // Highlight success
                        }
                        return `<div class="${cls}">${c}</div>`;
                    }).join('');

                    document.getElementById('pathDisplay').innerHTML = (step.path || []).map(p => 
                        `<div class="part-item">${p}</div>`
                    ).join('');

                    document.getElementById('resultsDisplay').innerHTML = (step.result || []).map((r, i) => {
                         const isNew = step.newFound && i === step.result.length - 1;
                         return `<span class="result-item${isNew?' new':''} ">[${r.map(x=>`"${x}"`).join(', ')}]</span>`;
                    }).join('');
                    
                    document.getElementById('countDisplay').textContent = step.result ? step.result.length : 0;
                }
            });
            viz.setSteps(generateAlgorithmSteps(currentStr));
        }

        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
