<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Search å–®è©æœç´¢ - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .grid { display: inline-grid; gap: 3px; margin: 20px auto; padding: 10px; background: var(--viz-bg-secondary); border-radius: 8px; }
        .cell { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 6px; background: var(--viz-primary); color: white; font-size: 1.2rem; transition: all 0.3s; }
        .cell.visited { background: var(--viz-success); color: #0f172a; }
        .cell.current { background: var(--viz-warning); color: #0f172a; animation: pulse 0.3s; }
        .cell.backtrack { background: var(--viz-error); opacity: 0.5; }
        @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .word { text-align: center; font-size: 1.5rem; font-weight: bold; margin: 10px 0; letter-spacing: 5px; }
        .word .char { display: inline-block; padding: 5px 10px; margin: 2px; border-radius: 4px; background: var(--viz-bg-secondary); }
        .word .char.found { background: var(--viz-success); color: #0f172a; }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">å–®è©æœç´¢ï¼ˆDFS + å›æº¯ï¼‰</div>
                <div class="word" id="wordDisplay"></div>
                <div style="text-align: center;"><div class="grid" id="gridDisplay"></div></div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                    <button class="viz-btn play-btn" id="playBtn" onclick="viz.toggleAutoPlay()">â–¶ è‡ªå‹•æ’­æ”¾</button>
                    <div class="speed-control">
                        <label>é€Ÿåº¦:</label>
                        <select id="speedSelect" onchange="viz.setSpeed(Number(this.value))">
                            <option value="2000">0.5x</option>
                            <option value="1500" selected>1x</option>
                            <option value="1000">1.5x</option>
                            <option value="500">2x</option>
                        </select>
                    </div>
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">çµæœ</div><div class="state-value" id="resultDisplay" style="color: var(--viz-success);">?</div></div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">æ¼”ç®—æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'bool exist(vector<vector<char>>& board, string word) {', id: 0 },
            { line: '    for (int i = 0; i < m; i++)', id: 1 },
            { line: '        for (int j = 0; j < n; j++)', id: 2 },
            { line: '            if (dfs(board, word, i, j, 0)) return true;', id: 3 },
            { line: '    return false;', id: 4 },
            { line: '}', id: 5 },
            { line: 'bool dfs(board, word, i, j, k) {', id: 6 },
            { line: '    if (k == word.size()) return true;', id: 7 },
            { line: '    if (è¶Šç•Œ || å·²è¨ªå• || board[i][j] != word[k]) return false;', id: 8 },
            { line: '    board[i][j] = \'#\'; // æ¨™è¨˜å·²è¨ªå•', id: 9 },
            { line: '    bool found = dfs(ä¸Š) || dfs(ä¸‹) || dfs(å·¦) || dfs(å³);', id: 10 },
            { line: '    board[i][j] = word[k]; // å›æº¯', id: 11 },
            { line: '    return found;', id: 12 },
            { line: '}', id: 13 },
        ];
        const board = [['A','B','C','E'],['S','F','C','S'],['A','D','E','E']];
        const word = "ABCCED";
        function generateAlgorithmSteps() {
            const steps = [];
            steps.push({ visited: [], current: null, foundChars: 0, highlightLines: [0,1,2,3], explanation: { title: 'åˆå§‹åŒ–', text: `board: 3Ã—4<br>word: "${word}"<br><br>å¾æ¯å€‹æ ¼å­é–‹å§‹ DFS<br>å››å€‹æ–¹å‘æœç´¢` } });
            const path = [[0,0],[0,1],[0,2],[1,2],[2,2],[2,1]]; // A-B-C-C-E-D
            for (let i = 0; i < path.length; i++) {
                steps.push({ visited: path.slice(0, i), current: path[i], foundChars: i+1, highlightLines: [6,7,8,9,10], explanation: { title: `æ‰¾åˆ° '${word[i]}'`, text: `ä½ç½® (${path[i][0]}, ${path[i][1]})<br>å·²åŒ¹é…ï¼š${word.slice(0, i+1)}` } });
            }
            steps.push({ visited: path, current: null, foundChars: 6, result: true, final: true, highlightLines: [7], explanation: { title: 'ğŸ‰ æ‰¾åˆ°å–®è©ï¼', text: `è·¯å¾‘ï¼šAâ†’Bâ†’Câ†’Câ†’Eâ†’D<br><br>æ™‚é–“ï¼šO(mÃ—nÃ—4^L)` } });
            return steps;
        }
        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    // Word display
                    let wordHtml = '';
                    for (let i = 0; i < word.length; i++) {
                        wordHtml += `<span class="char${i < step.foundChars ? ' found' : ''}">${word[i]}</span>`;
                    }
                    document.getElementById('wordDisplay').innerHTML = wordHtml;
                    // Grid display
                    const grid = document.getElementById('gridDisplay');
                    grid.style.gridTemplateColumns = `repeat(${board[0].length}, 45px)`;
                    let html = '';
                    for (let r = 0; r < board.length; r++) {
                        for (let c = 0; c < board[0].length; c++) {
                            let cls = 'cell';
                            if (step.current && step.current[0] === r && step.current[1] === c) cls += ' current';
                            else if (step.visited?.some(v => v[0] === r && v[1] === c)) cls += ' visited';
                            html += `<div class="${cls}">${board[r][c]}</div>`;
                        }
                    }
                    grid.innerHTML = html;
                    document.getElementById('resultDisplay').textContent = step.result ? 'true âœ“' : '?';
                }
            });
            viz.setSteps(generateAlgorithmSteps());
        }
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
