<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dijkstra's Algorithm æœ€çŸ­è·¯å¾‘ - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .graph { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin: 20px 0; }
        .node { width: 60px; height: 60px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: var(--viz-primary); color: white; transition: all 0.3s; }
        .node .id { font-weight: bold; font-size: 1.2rem; }
        .node .dist { font-size: 0.7rem; opacity: 0.8; }
        .node.current { background: var(--viz-secondary); color: #0f172a; }
        .node.visited { background: var(--viz-success); color: #0f172a; }
        .node.start { border: 3px solid var(--viz-warning); }
        .pq { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin: 10px 0; padding: 10px; background: var(--viz-bg-secondary); border-radius: 8px; }
        .pq-item { background: var(--viz-warning); color: #0f172a; padding: 4px 10px; border-radius: 4px; font-size: 0.85rem; }
    </style>
</head>
<body>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">Network Delay Timeï¼ˆDIJKSTRAï¼‰</div>
                <div class="graph" id="graphDisplay"></div>
                <div style="text-align: center; color: var(--text-muted); margin: 5px 0;">Priority Queue (min-heap)</div>
                <div class="pq" id="pqDisplay">ç©º</div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">èµ·é»</div><div class="state-value">1</div></div>
                    <div class="state-item"><div class="state-label">æœ€å¤§å»¶é²</div><div class="state-value" id="resultDisplay" style="color: var(--viz-success);">?</div></div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">æ¼”ç®—æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'int networkDelayTime(vector<vector<int>>& times, int n, int k) {', id: 0 },
            { line: '    vector<vector<pair<int,int>>> graph(n + 1);', id: 1 },
            { line: '    for (auto& t : times)', id: 2 },
            { line: '        graph[t[0]].push_back({t[1], t[2]});', id: 3 },
            { line: '    vector<int> dist(n + 1, INT_MAX);', id: 4 },
            { line: '    priority_queue<pair<int,int>, vector<pair<int,int>>,', id: 5 },
            { line: '                   greater<pair<int,int>>> pq;', id: 6 },
            { line: '    dist[k] = 0; pq.push({0, k});', id: 7 },
            { line: '    while (!pq.empty()) {', id: 8 },
            { line: '        auto [d, u] = pq.top(); pq.pop();', id: 9 },
            { line: '        if (d > dist[u]) continue;', id: 10 },
            { line: '        for (auto& [v, w] : graph[u]) {', id: 11 },
            { line: '            if (dist[u] + w < dist[v]) {', id: 12 },
            { line: '                dist[v] = dist[u] + w;', id: 13 },
            { line: '                pq.push({dist[v], v});', id: 14 },
            { line: '            }', id: 15 },
            { line: '        }', id: 16 },
            { line: '    }', id: 17 },
            { line: '    int maxDist = *max_element(dist.begin()+1, dist.end());', id: 18 },
            { line: '    return maxDist == INT_MAX ? -1 : maxDist;', id: 19 },
            { line: '}', id: 20 },
        ];
        function generateAlgorithmSteps() {
            const steps = [];
            // ç°¡åŒ–ç¯„ä¾‹ï¼š4 ç¯€é»
            steps.push({ nodes: {1: 0, 2: 'âˆ', 3: 'âˆ', 4: 'âˆ'}, current: null, visited: [], pq: [{d:0,n:1}], highlightLines: [0,1,4,5,6,7], explanation: { title: 'åˆå§‹åŒ–', text: 'å»ºç«‹åœ–å’Œè·é›¢é™£åˆ—<br>èµ·é» 1 è·é›¢ = 0<br>å…¶ä»– = âˆ' } });
            steps.push({ nodes: {1: 0, 2: 1, 3: 1, 4: 'âˆ'}, current: 1, visited: [1], pq: [{d:1,n:2},{d:1,n:3}], highlightLines: [8,9,10,11,12,13,14], explanation: { title: 'è™•ç†ç¯€é» 1', text: 'å¾èµ·é»å‡ºç™¼<br>æ›´æ–°é„°å±…ï¼š2=1, 3=1', formula: 'dist[2] = 0+1=1, dist[3] = 0+1=1' } });
            steps.push({ nodes: {1: 0, 2: 1, 3: 1, 4: 2}, current: 2, visited: [1,2], pq: [{d:1,n:3},{d:2,n:4}], highlightLines: [9,11,12,13,14], explanation: { title: 'è™•ç†ç¯€é» 2', text: 'æ›´æ–°é„°å±… 4<br>dist[4] = 1+1=2', formula: 'dist[4] = dist[2]+1 = 2' } });
            steps.push({ nodes: {1: 0, 2: 1, 3: 1, 4: 2}, current: 3, visited: [1,2,3], pq: [{d:2,n:4}], highlightLines: [9,11], explanation: { title: 'è™•ç†ç¯€é» 3', text: 'ç¯€é» 3 çš„é„°å±…å·²æœ‰æ›´çŸ­è·¯å¾‘' } });
            steps.push({ nodes: {1: 0, 2: 1, 3: 1, 4: 2}, current: 4, visited: [1,2,3,4], pq: [], result: 2, highlightLines: [18,19], explanation: { title: 'ğŸ‰ å®Œæˆï¼', text: 'æ‰€æœ‰ç¯€é»éƒ½å·²è¨ªå•<br>æœ€å¤§è·é›¢ = 2<br><br>æ™‚é–“ï¼šO((V+E)logV)' } });
            return steps;
        }
        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    let html = '';
                    for (const [id, dist] of Object.entries(step.nodes || {})) {
                        let cls = 'node';
                        if (+id === step.current) cls += ' current';
                        if (step.visited?.includes(+id)) cls += ' visited';
                        if (+id === 1) cls += ' start';
                        html += `<div class="${cls}"><div class="id">${id}</div><div class="dist">d=${dist}</div></div>`;
                    }
                    document.getElementById('graphDisplay').innerHTML = html;
                    document.getElementById('pqDisplay').innerHTML = (step.pq || []).length > 0 
                        ? step.pq.map(p => `<span class="pq-item">(${p.d},${p.n})</span>`).join('') 
                        : 'ç©º';
                    document.getElementById('resultDisplay').textContent = step.result ?? '?';
                }
            });
            viz.setSteps(generateAlgorithmSteps());
        }
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
