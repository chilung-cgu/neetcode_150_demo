<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walls and Gates ç‰†èˆ‡é–€ - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .grid { display: inline-grid; gap: 2px; margin: 20px auto; }
        .cell { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 4px; font-size: 0.9rem; transition: all 0.3s; }
        .cell.wall { background: #333; color: #666; }
        .cell.gate { background: var(--viz-success); color: #0f172a; }
        .cell.empty { background: var(--viz-bg-secondary); color: var(--text-muted); }
        .cell.updated { background: var(--viz-warning); color: #0f172a; animation: flash 0.3s; }
        @keyframes flash { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">ç‰†èˆ‡é–€ï¼ˆå¤šæº BFSï¼‰</div>
                <div style="text-align: center;"><div class="grid" id="gridDisplay"></div></div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">æ¼”ç®—æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'void wallsAndGates(vector<vector<int>>& rooms) {', id: 0 },
            { line: '    queue<pair<int,int>> q;', id: 1 },
            { line: '    for (all cells) if (gate) q.push({i, j});', id: 2 },
            { line: '    while (!q.empty()) {', id: 3 },
            { line: '        auto [r, c] = q.front(); q.pop();', id: 4 },
            { line: '        for (å››å€‹æ–¹å‘) {', id: 5 },
            { line: '            if (rooms[nr][nc] > rooms[r][c] + 1) {', id: 6 },
            { line: '                rooms[nr][nc] = rooms[r][c] + 1;', id: 7 },
            { line: '                q.push({nr, nc});', id: 8 },
            { line: '            }', id: 9 },
            { line: '        }', id: 10 },
            { line: '    }', id: 11 },
            { line: '}', id: 12 },
        ];
        const INF = 2147483647;
        function generateAlgorithmSteps() {
            const steps = [];
            const g0 = [[INF,-1,0,INF],[INF,INF,INF,-1],[INF,-1,INF,-1],[0,-1,INF,INF]];
            steps.push({ grid: g0, updated: [], highlightLines: [0,1,2], explanation: { title: 'åˆå§‹åŒ–', text: '-1 = ç‰†, 0 = é–€, âˆ = ç©ºæˆ¿<br><br>å¤šæº BFSï¼šå¾æ‰€æœ‰é–€åŒæ™‚é–‹å§‹' } });
            const g1 = [[3,-1,0,1],[2,2,1,-1],[1,-1,2,-1],[0,-1,3,4]];
            steps.push({ grid: [[INF,-1,0,1],[INF,INF,1,-1],[1,-1,2,-1],[0,-1,INF,INF]], updated: [[0,3],[1,2],[2,0],[2,2]], highlightLines: [3,4,5,6,7,8], explanation: { title: 'ç¬¬ 1 è¼ª', text: 'è·é›¢é–€ 1 æ­¥çš„æˆ¿é–“' } });
            steps.push({ grid: [[3,-1,0,1],[2,2,1,-1],[1,-1,2,-1],[0,-1,3,4]], updated: [[0,0],[1,0],[1,1],[2,2],[3,2],[3,3]], highlightLines: [3,4,5,6,7,8], explanation: { title: 'å®Œæˆ', text: 'æ‰€æœ‰æˆ¿é–“å¡«å…¥æœ€è¿‘é–€è·é›¢' } });
            steps.push({ grid: g1, final: true, highlightLines: [11,12], explanation: { title: 'ğŸ‰ å®Œæˆï¼', text: 'æ¯å€‹ç©ºæˆ¿éƒ½æœ‰æœ€è¿‘é–€è·é›¢<br><br>æ™‚é–“ï¼šO(mÃ—n)' } });
            return steps;
        }
        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    const grid = step.grid;
                    const g = document.getElementById('gridDisplay');
                    g.style.gridTemplateColumns = `repeat(${grid[0].length}, 45px)`;
                    let html = '';
                    for (let r = 0; r < grid.length; r++) {
                        for (let c = 0; c < grid[0].length; c++) {
                            const val = grid[r][c];
                            let cls = 'cell';
                            if (val === -1) cls += ' wall';
                            else if (val === 0) cls += ' gate';
                            else if (val === INF) cls += ' empty';
                            else cls += ' updated';
                            if (step.updated?.some(u => u[0]===r && u[1]===c)) cls = 'cell updated';
                            const display = val === -1 ? 'ç‰†' : (val === INF ? 'âˆ' : (val === 0 ? 'é–€' : val));
                            html += `<div class="${cls}">${display}</div>`;
                        }
                    }
                    g.innerHTML = html;
                }
            });
            viz.setSteps(generateAlgorithmSteps());
        }
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
