<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surrounded Regions - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .custom-input-section { background: var(--viz-card-bg); border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--viz-border); }
        .input-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .input-row button { padding: 8px 16px; border-radius: 6px; background: var(--viz-primary); color: white; border: none; cursor: pointer; }

        .grid-container { display: inline-grid; gap: 2px; margin: 20px auto; }
        .cell { 
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; 
            font-weight: bold; border-radius: 4px; font-size: 1.1rem; transition: all 0.3s;
            border: 2px solid transparent;
        }
        .cell.O { background: var(--viz-primary); color: white; }
        .cell.X { background: var(--viz-bg-secondary); color: var(--viz-text-muted); }
        .cell.safe { background: var(--viz-success); color: #0f172a; border-color: var(--viz-success); }
        .cell.captured { background: var(--viz-error); color: white; animation: capture 0.4s; }
        .cell.checking { border-color: white; }
        @keyframes capture { 0% { transform: scale(1.2); } 100% { transform: scale(1); } }

        .legend-row { display: flex; gap: 15px; justify-content: center; margin: 10px 0; font-size: 0.85rem; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-box { width: 20px; height: 20px; border-radius: 4px; }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">è¢«åœç¹çš„å€åŸŸ (Surrounded Regions)</div>
                <div class="custom-input-section">
                    <div style="font-weight:bold; margin-bottom:5px;">ğŸ® è‡ªè¨‚æ¸¬è©¦</div>
                    <div class="input-row">
                        <button onclick="setExample(1)">ç¯„ä¾‹1 (4x4)</button>
                        <button onclick="setExample(2)">ç¯„ä¾‹2 (5x5)</button>
                        <button onclick="resetVisualization()">â†» é‡ç½®</button>
                    </div>
                </div>
                
                <div class="legend-row">
                    <div class="legend-item"><div class="legend-box" style="background:var(--viz-bg-secondary)"></div>X (ç‰†)</div>
                    <div class="legend-item"><div class="legend-box" style="background:var(--viz-primary)"></div>O (åŸå§‹)</div>
                    <div class="legend-item"><div class="legend-box" style="background:var(--viz-success)"></div>å®‰å…¨ (é€£æ¥é‚Šç•Œ)</div>
                    <div class="legend-item"><div class="legend-box" style="background:var(--viz-error)"></div>è¢«æ•ç²</div>
                </div>
                
                <div style="text-align: center;"><div class="grid-container" id="gridDisplay"></div></div>

                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <div class="speed-control">
                        <label>é€Ÿåº¦:</label>
                        <select id="speedSelect" onchange="viz.setSpeed(Number(this.value))">
                            <option value="1500">1x</option>
                            <option value="800">2x</option>
                        </select>
                    </div>
                </div>
                
                <div class="complexity-badge">
                    <span class="label">Time:</span> O(mÃ—n)
                    <span class="label" style="margin-left: 12px;">Space:</span> O(mÃ—n)
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">è¢«æ•ç²æ•¸</div><div class="state-value" id="capturedDisplay">0</div></div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">æ¼”ç®—æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'void solve(vector<vector<char>>& board) {', id: 0 },
            { line: '    int m = board.size(), n = board[0].size();', id: 1 },
            { line: '    // å¾é‚Šç•Œçš„ O é–‹å§‹ DFSï¼Œæ¨™è¨˜ç‚ºå®‰å…¨ (S)', id: 2 },
            { line: '    for (int i = 0; i < m; i++) {', id: 3 },
            { line: '        dfs(board, i, 0); dfs(board, i, n-1);', id: 4 },
            { line: '    }', id: 5 },
            { line: '    for (int j = 0; j < n; j++) {', id: 6 },
            { line: '        dfs(board, 0, j); dfs(board, m-1, j);', id: 7 },
            { line: '    }', id: 8 },
            { line: '    // O â†’ X (è¢«æ•ç²), S â†’ O (æ¢å¾©å®‰å…¨)', id: 9 },
            { line: '    for (int i = 0; i < m; i++) {', id: 10 },
            { line: '        for (int j = 0; j < n; j++) {', id: 11 },
            { line: '            if (board[i][j] == \'O\') board[i][j] = \'X\';', id: 12 },
            { line: '            if (board[i][j] == \'S\') board[i][j] = \'O\';', id: 13 },
            { line: '        }', id: 14 },
            { line: '    }', id: 15 },
            { line: '}', id: 16 },
        ];
        
        const examples = {
            1: [['X','X','X','X'],['X','O','O','X'],['X','X','O','X'],['X','O','X','X']],
            2: [['X','X','X','X','X'],['X','O','O','O','X'],['X','X','O','X','X'],['X','O','X','O','X'],['X','O','X','X','X']]
        };
        
        let currentBoard = examples[1];

        function setExample(n) {
            currentBoard = examples[n].map(r => [...r]);
            init();
        }

        function generateAlgorithmSteps(initialBoard) {
            const steps = [];
            const m = initialBoard.length, n = initialBoard[0].length;
            let board = initialBoard.map(r => [...r]);
            const dirs = [[1,0],[-1,0],[0,1],[0,-1]];
            
            // Count initial O's
            let totalO = 0;
            for (let i = 0; i < m; i++) {
                for (let j = 0; j < n; j++) {
                    if (board[i][j] === 'O') totalO++;
                }
            }
            
            steps.push({
                board: board.map(r => [...r]), safe: [], captured: [],
                highlightLines: [0, 1, 2],
                explanation: { 
                    title: 'åˆå§‹åŒ–', 
                    text: `${m}Ã—${n} æ£‹ç›¤ï¼Œå…± ${totalO} å€‹ O<br><br>é—œéµæ´å¯Ÿï¼š<br>èˆ‡é‚Šç•Œé€£é€šçš„ O ä¸æœƒè¢«æ•ç²<br>å¾é‚Šç•Œ O é–‹å§‹ DFS æ¨™è¨˜`,
                    formula: 'border DFS'
                }
            });

            // DFS to mark safe cells
            const safe = [];
            function dfs(i, j) {
                if (i < 0 || i >= m || j < 0 || j >= n) return;
                if (board[i][j] !== 'O') return;
                board[i][j] = 'S';
                safe.push([i, j]);
                for (const [di, dj] of dirs) {
                    dfs(i + di, j + dj);
                }
            }

            // Mark border cells
            for (let i = 0; i < m; i++) {
                dfs(i, 0);
                dfs(i, n - 1);
            }
            for (let j = 0; j < n; j++) {
                dfs(0, j);
                dfs(m - 1, j);
            }

            if (safe.length > 0) {
                steps.push({
                    board: board.map(r => [...r]), safe: [...safe], captured: [],
                    highlightLines: [3, 4, 5, 6, 7, 8],
                    explanation: { 
                        title: 'æ¨™è¨˜å®‰å…¨å€åŸŸ', 
                        text: `å¾é‚Šç•Œ O é–‹å§‹ DFS<br>æ‰¾åˆ° ${safe.length} å€‹é€£æ¥é‚Šç•Œçš„ O<br>æ¨™è¨˜ç‚ºå®‰å…¨ (S)`,
                        formula: `safe: ${safe.length}`
                    }
                });
            }

            // Capture surrounded O's
            const captured = [];
            for (let i = 0; i < m; i++) {
                for (let j = 0; j < n; j++) {
                    if (board[i][j] === 'O') {
                        board[i][j] = 'X';
                        captured.push([i, j]);
                    }
                }
            }

            if (captured.length > 0) {
                steps.push({
                    board: board.map(r => [...r]), safe: [...safe], captured: [...captured],
                    highlightLines: [10, 11, 12],
                    explanation: { 
                        title: 'æ•ç²è¢«åœç¹çš„ O', 
                        text: `${captured.length} å€‹ O æ²’æœ‰é€£æ¥é‚Šç•Œ<br>O â†’ X`,
                        formula: `captured: ${captured.length}`
                    }
                });
            }

            // Restore safe cells
            for (let i = 0; i < m; i++) {
                for (let j = 0; j < n; j++) {
                    if (board[i][j] === 'S') {
                        board[i][j] = 'O';
                    }
                }
            }

            steps.push({
                board: board.map(r => [...r]), safe: [], captured: [], 
                restored: [...safe], capturedCount: captured.length, final: true,
                highlightLines: [13, 14, 15, 16],
                explanation: { 
                    title: 'å®Œæˆ!', 
                    text: `æ¢å¾©å®‰å…¨çš„ O (S â†’ O)<br><br>è¢«æ•ç²: ${captured.length}<br>å®‰å…¨: ${safe.length}`,
                    formula: `done`
                }
            });

            return steps;
        }

        let viz;
        function init() {
            const m = currentBoard.length, n = currentBoard[0].length;
            const gridEl = document.getElementById('gridDisplay');
            gridEl.style.gridTemplateColumns = `repeat(${n}, 40px)`;
            
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    const board = step.board;
                    let html = '';
                    for (let r = 0; r < board.length; r++) {
                        for (let c = 0; c < board[0].length; c++) {
                            const val = board[r][c];
                            let cls = `cell ${val === 'S' ? 'O' : val}`;
                            
                            if (step.safe?.some(s => s[0] === r && s[1] === c)) {
                                cls = 'cell safe';
                            }
                            if (step.captured?.some(s => s[0] === r && s[1] === c)) {
                                cls = 'cell captured';
                            }
                            if (step.restored?.some(s => s[0] === r && s[1] === c)) {
                                cls = 'cell O';
                            }
                            
                            const display = val === 'S' ? 'S' : val;
                            html += `<div class="${cls}">${display}</div>`;
                        }
                    }
                    gridEl.innerHTML = html;
                    document.getElementById('capturedDisplay').textContent = step.capturedCount ?? step.captured?.length ?? 0;
                }
            });
            viz.setSteps(generateAlgorithmSteps(currentBoard));
        }
        
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
