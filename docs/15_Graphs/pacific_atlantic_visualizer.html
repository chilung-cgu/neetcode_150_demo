<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pacific Atlantic Water Flow Visualization</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .grid { display: grid; gap: 2px; max-width: 200px; margin: 0 auto; }
        .cell { width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; font-family: monospace; border-radius: 3px; font-size: 0.85rem; background: var(--viz-primary); color: white; }
        .cell.pacific { background: #3b82f6; }
        .cell.atlantic { background: #f59e0b; color: #0f172a; }
        .cell.both { background: var(--viz-success); color: #0f172a; }
    </style>
</head>
<body>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">PACIFIC ATLANTIC WATER FLOW</div>
                <div style="text-align: center; font-size: 0.8rem; color: var(--viz-text-muted);">Pacific ← Top/Left, Atlantic → Bottom/Right</div>
                <div class="grid" id="gridDisplay" style="grid-template-columns: repeat(5, 35px);"></div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">← Prev</button>
                    <div class="step-indicator">Step <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">Next →</button>
                    <button class="viz-btn" onclick="resetVisualization()">↻ Reset</button>
                </div>
            </div>
            <div class="viz-card">
                <div class="viz-title">EXPLANATION</div>
                <div class="explanation" id="explanation"></div>
            </div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%; box-sizing: border-box;">
                <div class="viz-title">REVERSE DFS</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'vector<vector<int>> pacificAtlantic(heights) {', id: 0 },
            { line: '    set<pair<int,int>> pacific, atlantic;', id: 1 },
            { line: '    // DFS from Pacific borders (top, left)', id: 2 },
            { line: '    // DFS from Atlantic borders (bottom, right)', id: 3 },
            { line: '    // Return intersection', id: 4 },
            { line: '    vector<vector<int>> result;', id: 5 },
            { line: '    for each cell in both sets:', id: 6 },
            { line: '        result.push_back({i, j});', id: 7 },
            { line: '    return result;', id: 8 },
            { line: '}', id: 9 },
        ];
        const grid = [[1,2,2,3,5],[3,2,3,4,4],[2,4,5,3,1],[6,7,1,4,5],[5,1,1,2,4]];

        function generateAlgorithmSteps() {
            const steps = [];
            const pacific = [[0,4],[1,3],[1,4],[2,2],[3,0],[3,1],[4,0]];
            const atlantic = [[0,4],[1,3],[1,4],[2,2],[3,0],[3,1],[4,0]];
            const both = [[0,4],[1,3],[1,4],[2,2],[3,0],[3,1],[4,0]];
            
            steps.push({ pacific: [], atlantic: [], highlightLines: [0, 1], explanation: { title: 'Init', text: 'Reverse DFS from oceans' }});
            steps.push({ pacific: [[0,0],[0,1],[0,2],[0,3],[0,4],[1,0],[2,0],[3,0],[4,0]], atlantic: [], highlightLines: [2], explanation: { title: 'Pacific DFS', text: 'Blue = reachable from Pacific' }});
            steps.push({ pacific: [[0,0],[0,1],[0,2],[0,3],[0,4],[1,0],[2,0],[3,0],[4,0]], atlantic: [[4,4],[4,3],[4,2],[4,1],[4,0],[3,4],[2,4],[1,4],[0,4]], highlightLines: [3], explanation: { title: 'Atlantic DFS', text: 'Orange = reachable from Atlantic' }});
            steps.push({ both: [[0,4],[3,0],[4,0]], highlightLines: [6, 7], explanation: { title: 'Intersection', text: 'Green = both oceans' }});
            
            return steps;
        }

        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    let html = '';
                    for (let i = 0; i < 5; i++) {
                        for (let j = 0; j < 5; j++) {
                            const inBoth = step.both?.some(c => c[0] === i && c[1] === j);
                            const inPacific = step.pacific?.some(c => c[0] === i && c[1] === j);
                            const inAtlantic = step.atlantic?.some(c => c[0] === i && c[1] === j);
                            let cls = 'cell';
                            if (inBoth) cls += ' both';
                            else if (inPacific) cls += ' pacific';
                            else if (inAtlantic) cls += ' atlantic';
                            html += `<div class="${cls}">${grid[i][j]}</div>`;
                        }
                    }
                    document.getElementById('gridDisplay').innerHTML = html;
                }
            });
            viz.setSteps(generateAlgorithmSteps());
        }
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
