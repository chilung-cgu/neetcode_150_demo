<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reverse Bits - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .custom-input-section { background: var(--viz-card-bg); border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--viz-border); }
        .input-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .input-row button { padding: 8px 16px; border-radius: 6px; background: var(--viz-primary); color: white; border: none; cursor: pointer; }

        .binary-section { margin: 20px 0; padding: 15px; background: var(--viz-bg-secondary); border-radius: 10px; }
        .section-label { text-align: center; color: var(--viz-text-muted); font-size: 0.85rem; margin-bottom: 10px; }
        
        .binary-row { display: flex; gap: 3px; justify-content: center; font-family: monospace; }
        .bit { 
            width: 28px; height: 34px; display: flex; align-items: center; justify-content: center; 
            font-weight: bold; border-radius: 4px; font-size: 1rem; transition: all 0.3s;
        }
        .bit.zero { background: var(--viz-bg-primary); color: var(--viz-text-muted); }
        .bit.one { background: var(--viz-success); color: #0f172a; }
        .bit.current { border: 3px solid var(--viz-warning); transform: scale(1.1); }
        .bit.new { animation: pulse 0.4s; }
        @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.2); } }

        .arrow-display { text-align: center; font-size: 1.5rem; color: var(--viz-secondary); margin: 15px 0; }

        .operation-display {
            text-align: center; margin: 15px 0; padding: 12px;
            background: var(--viz-bg-secondary); border-radius: 8px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">é¡›å€’äºŒé€²ä½ä½å…ƒ (Reverse Bits)</div>
                <div class="custom-input-section">
                    <div style="font-weight:bold; margin-bottom:5px;">ğŸ® è‡ªè¨‚æ¸¬è©¦ (8ä½ç°¡åŒ–ç¤ºç¯„)</div>
                    <div class="input-row">
                        <button onclick="setExample(1)">n = 43 (00101011)</button>
                        <button onclick="setExample(2)">n = 165 (10100101)</button>
                        <button onclick="resetVisualization()">â†» é‡ç½®</button>
                    </div>
                </div>
                
                <div class="binary-section">
                    <div class="section-label">åŸå§‹ (å¾å³å¾€å·¦è®€å–)</div>
                    <div class="binary-row" id="originalDisplay"></div>
                </div>
                
                <div class="arrow-display">â†“ é¡›å€’ â†“</div>
                
                <div class="binary-section">
                    <div class="section-label">çµæœ (å¾å·¦å¾€å³å»ºç«‹)</div>
                    <div class="binary-row" id="resultDisplay"></div>
                </div>
                
                <div class="operation-display" id="operationDisplay"></div>

                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <div class="speed-control">
                        <label>é€Ÿåº¦:</label>
                        <select id="speedSelect" onchange="viz.setSpeed(Number(this.value))">
                            <option value="1500">1x</option>
                            <option value="500">2x</option>
                        </select>
                    </div>
                </div>
                
                <div class="complexity-badge">
                    <span class="label">Time:</span> O(1) å›ºå®š32ä½
                    <span class="label" style="margin-left: 12px;">Space:</span> O(1)
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">è¼¸å…¥</div><div class="state-value" id="inputDisplay">-</div></div>
                    <div class="state-item"><div class="state-label">è¼¸å‡º</div><div class="state-value" id="outputDisplay">-</div></div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">æ¼”ç®—æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'uint32_t reverseBits(uint32_t n) {', id: 0 },
            { line: '    uint32_t result = 0;', id: 1 },
            { line: '    for (int i = 0; i < 32; i++) {', id: 2 },
            { line: '        result <<= 1;       // çµæœå·¦ç§»', id: 3 },
            { line: '        result |= (n & 1);  // åŠ å…¥æœ€ä½ä½', id: 4 },
            { line: '        n >>= 1;            // åŸæ•¸å³ç§»', id: 5 },
            { line: '    }', id: 6 },
            { line: '    return result;', id: 7 },
            { line: '}', id: 8 },
        ];
        
        const examples = {
            1: 43,   // 00101011
            2: 165   // 10100101
        };
        
        let currentNumber = examples[1];
        const BITS = 8;  // Simplified demo

        function setExample(num) {
            currentNumber = examples[num];
            init();
        }

        function toBinary(n) {
            return (n >>> 0).toString(2).padStart(BITS, '0');
        }

        function generateAlgorithmSteps(input) {
            const steps = [];
            let n = input;
            let result = 0;
            
            steps.push({
                n: input, result: 0, pos: -1, originalPos: -1, input,
                highlightLines: [0, 1],
                explanation: { 
                    title: 'åˆå§‹åŒ–', 
                    text: `è¼¸å…¥: ${input} = ${toBinary(input)}<br><br>æ¼”ç®—æ³•:<br>1. result å·¦ç§»<br>2. åŠ å…¥ n çš„æœ€ä½ä½<br>3. n å³ç§»<br>é‡è¤‡ 32 æ¬¡`,
                    formula: 'setup'
                }
            });

            for (let i = 0; i < BITS; i++) {
                const bit = n & 1;
                result = (result << 1) | bit;
                n >>= 1;
                
                steps.push({
                    n, result, pos: i, originalPos: i, input, currentBit: bit,
                    highlightLines: [2, 3, 4, 5],
                    explanation: { 
                        title: `æ­¥é©Ÿ ${i + 1}`, 
                        text: `å–æœ€ä½ä½: ${bit}<br>result = ${toBinary(result)}<br><br>result <<= 1, ç„¶å¾Œ |= ${bit}`,
                        formula: `bit = ${bit}`
                    }
                });
            }

            steps.push({
                n: 0, result, pos: -1, originalPos: -1, input, final: true,
                highlightLines: [7],
                explanation: { 
                    title: 'å®Œæˆ!', 
                    text: `${toBinary(input)} â†’ ${toBinary(result)}<br><br>${input} â†’ ${result}<br><br>ä½å…ƒé †åºå®Œå…¨é¡›å€’`,
                    formula: `return ${result}`
                }
            });

            return steps;
        }

        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    const input = step.input || currentNumber;
                    const inputBinary = toBinary(input);
                    const resultBinary = toBinary(step.result || 0);
                    
                    // Original display (reading from right)
                    document.getElementById('originalDisplay').innerHTML = 
                        inputBinary.split('').map((b, i) => {
                            let cls = `bit ${b === '1' ? 'one' : 'zero'}`;
                            if (step.originalPos >= 0 && (BITS - 1 - i) === step.originalPos) {
                                cls += ' current';
                            }
                            return `<span class="${cls}">${b}</span>`;
                        }).join('');
                    
                    // Result display (building from left)
                    document.getElementById('resultDisplay').innerHTML = 
                        resultBinary.split('').map((b, i) => {
                            let cls = `bit ${b === '1' ? 'one' : 'zero'}`;
                            if (step.pos >= 0 && i === (BITS - 1 - step.pos)) {
                                cls += ' new';
                            }
                            return `<span class="${cls}">${b}</span>`;
                        }).join('');
                    
                    // Operation display
                    if (step.currentBit !== undefined) {
                        document.getElementById('operationDisplay').innerHTML = 
                            `å–ä½å…ƒ <strong>${step.currentBit}</strong> â†’ result = ${toBinary(step.result)}`;
                    } else if (step.final) {
                        document.getElementById('operationDisplay').innerHTML = 
                            `<span style="color: var(--viz-success);">å®Œæˆ! ${input} â†’ ${step.result}</span>`;
                    } else {
                        document.getElementById('operationDisplay').innerHTML = 
                            '<span style="color: var(--viz-text-muted);">ç­‰å¾…é–‹å§‹...</span>';
                    }
                    
                    document.getElementById('inputDisplay').textContent = input;
                    document.getElementById('outputDisplay').textContent = step.final ? step.result : '-';
                    document.getElementById('outputDisplay').style.color = step.final ? 'var(--viz-success)' : 'inherit';
                }
            });
            viz.setSteps(generateAlgorithmSteps(currentNumber));
        }
        
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
