<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validate Binary Search Tree - è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .tree { display: flex; flex-direction: column; align-items: center; margin: 20px 0; }
        .level { display: flex; gap: 20px; margin: 8px 0; justify-content: center; }
        .node { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 50%; background: var(--viz-primary); color: white; transition: all 0.3s; position: relative; }
        .node.current { background: var(--viz-secondary); color: #0f172a; }
        .node.valid { background: var(--viz-success); color: #0f172a; }
        .node.invalid { background: var(--viz-error); }
        .node .range { position: absolute; top: -20px; font-size: 0.6rem; color: var(--text-muted); white-space: nowrap; }
    </style>
</head>
<body>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">é©—è­‰äºŒå…ƒæœå°‹æ¨¹ï¼ˆDFSï¼‰</div>
                <div class="tree" id="treeDisplay"></div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                </div>
                <div class="state-grid">
                    <div class="state-item"><div class="state-label">çµæœ</div><div class="state-value" id="resultDisplay" style="color: var(--viz-success);">?</div></div>
                </div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%;">
                <div class="viz-title">æ¼”ç®—æ³• (C++)</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'bool isValidBST(TreeNode* root) {', id: 0 },
            { line: '    return validate(root, LONG_MIN, LONG_MAX);', id: 1 },
            { line: '}', id: 2 },
            { line: 'bool validate(TreeNode* node, long min, long max) {', id: 3 },
            { line: '    if (!node) return true;', id: 4 },
            { line: '    if (node->val <= min || node->val >= max)', id: 5 },
            { line: '        return false;', id: 6 },
            { line: '    return validate(node->left, min, node->val) &&', id: 7 },
            { line: '           validate(node->right, node->val, max);', id: 8 },
            { line: '}', id: 9 },
        ];
        // Valid BST: 2, 1, 3
        function generateAlgorithmSteps() {
            const steps = [];
            steps.push({ nodes: {2: {range: '(-âˆ, âˆ)'}, 1: {}, 3: {}}, current: null, valid: [], highlightLines: [0,1], explanation: { title: 'åˆå§‹åŒ–', text: 'æ¨¹çµæ§‹ï¼š<br>    2<br>   / \\<br>  1   3<br><br>BST è¦å‰‡ï¼šå·¦ < æ ¹ < å³<br>ç”¨ç¯„åœé©—è­‰æ¯å€‹ç¯€é»' } });
            steps.push({ nodes: {2: {range: '(-âˆ, âˆ)'}, 1: {range: '(-âˆ, 2)'}, 3: {range: '(2, âˆ)'}}, current: 2, valid: [], highlightLines: [3,4,5,7,8], explanation: { title: 'é©—è­‰ç¯€é» 2', text: 'ç¯„åœï¼š(-âˆ, âˆ)<br>-âˆ < 2 < âˆ âœ“<br><br>éè¿´é©—è­‰å­ç¯€é»', formula: '-âˆ < 2 < âˆ âœ“' } });
            steps.push({ nodes: {2: {range: '(-âˆ, âˆ)'}, 1: {range: '(-âˆ, 2)'}, 3: {range: '(2, âˆ)'}}, current: 1, valid: [2], highlightLines: [7,5], explanation: { title: 'é©—è­‰ç¯€é» 1', text: 'ç¯„åœï¼š(-âˆ, 2)<br>-âˆ < 1 < 2 âœ“', formula: '-âˆ < 1 < 2 âœ“' } });
            steps.push({ nodes: {2: {range: '(-âˆ, âˆ)'}, 1: {range: '(-âˆ, 2)'}, 3: {range: '(2, âˆ)'}}, current: 3, valid: [2, 1], highlightLines: [8,5], explanation: { title: 'é©—è­‰ç¯€é» 3', text: 'ç¯„åœï¼š(2, âˆ)<br>2 < 3 < âˆ âœ“', formula: '2 < 3 < âˆ âœ“' } });
            steps.push({ nodes: {2: {range: '(-âˆ, âˆ)'}, 1: {range: '(-âˆ, 2)'}, 3: {range: '(2, âˆ)'}}, valid: [2, 1, 3], result: true, highlightLines: [7,8], explanation: { title: 'ğŸ‰ æ˜¯æœ‰æ•ˆ BSTï¼', text: 'æ‰€æœ‰ç¯€é»éƒ½æ»¿è¶³ç¯„åœæ¢ä»¶<br><br>å›å‚³ true<br>æ™‚é–“ï¼šO(n)' } });
            return steps;
        }
        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    const tree = [[2], [1, 3]];
                    const nodeVals = [2, 1, 3];
                    let html = '';
                    tree.forEach((level, li) => {
                        html += '<div class="level">';
                        level.forEach(n => {
                            let cls = 'node';
                            if (n === step.current) cls += ' current';
                            if (step.valid?.includes(n)) cls += ' valid';
                            const range = step.nodes?.[n]?.range || '';
                            html += `<div class="${cls}"><span class="range">${range}</span>${n}</div>`;
                        });
                        html += '</div>';
                    });
                    document.getElementById('treeDisplay').innerHTML = html;
                    document.getElementById('resultDisplay').textContent = step.result ? 'true âœ“' : '?';
                }
            });
            viz.setSteps(generateAlgorithmSteps());
        }
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
