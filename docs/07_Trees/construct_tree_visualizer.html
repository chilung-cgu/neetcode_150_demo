<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construct Binary Tree Visualization</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .array-display { display: flex; gap: 4px; justify-content: center; margin: 8px 0; flex-wrap: wrap; }
        .arr-item { padding: 6px 10px; border-radius: 4px; font-family: monospace; background: rgba(255,255,255,0.1); font-size: 0.9rem; }
        .arr-item.root { background: var(--viz-success); color: #0f172a; }
        .arr-item.left { background: var(--viz-primary); }
        .arr-item.right { background: var(--viz-secondary); color: #0f172a; }
        .tree-level { display: flex; justify-content: center; gap: 10px; margin: 5px 0; }
        .tree-node { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: monospace; background: var(--viz-success); color: #0f172a; font-size: 0.85rem; }
    </style>
</head>
<body>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">CONSTRUCT BINARY TREE FROM PREORDER & INORDER</div>
                <div style="text-align: center; margin-bottom: 10px;">
                    <div style="color: var(--viz-text-muted); margin-bottom: 4px;">Preorder (Root-Left-Right):</div>
                    <div class="array-display" id="preorderDisplay"></div>
                    <div style="color: var(--viz-text-muted); margin: 8px 0 4px;">Inorder (Left-Root-Right):</div>
                    <div class="array-display" id="inorderDisplay"></div>
                </div>
                <div style="text-align: center; margin-top: 15px; color: var(--viz-text-muted);">Constructed Tree:</div>
                <div id="treeDisplay"></div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">← Prev</button>
                    <div class="step-indicator">Step <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">Next →</button>
                    <button class="viz-btn" onclick="resetVisualization()">↻ Reset</button>
                </div>
            </div>
            <div class="viz-card">
                <div class="viz-title">EXPLANATION</div>
                <div class="explanation" id="explanation"></div>
            </div>
        </div>
        <div class="code-area">
            <div class="viz-card" style="height: 100%; box-sizing: border-box;">
                <div class="viz-title">RECURSIVE APPROACH</div>
                <div class="code-panel" id="codeDisplay"></div>
            </div>
        </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'TreeNode* buildTree(preorder, inorder) {', id: 0 },
            { line: '    if (preorder.empty()) return nullptr;', id: 1 },
            { line: '    int rootVal = preorder[0];', id: 2 },
            { line: '    TreeNode* root = new TreeNode(rootVal);', id: 3 },
            { line: '    int mid = find(inorder, rootVal);', id: 4 },
            { line: '    // Left subtree: inorder[0..mid-1]', id: 5 },
            { line: '    root->left = buildTree(preLeft, inLeft);', id: 6 },
            { line: '    // Right subtree: inorder[mid+1..end]', id: 7 },
            { line: '    root->right = buildTree(preRight, inRight);', id: 8 },
            { line: '    return root;', id: 9 },
            { line: '}', id: 10 },
        ];
        const preorder = [3, 9, 20, 15, 7];
        const inorder = [9, 3, 15, 20, 7];

        function generateAlgorithmSteps() {
            const steps = [];
            steps.push({ tree: [], rootIdx: 0, leftIn: [], rightIn: [], highlightLines: [0, 1, 2], explanation: { title: 'Start', text: 'preorder[0] = root' }});
            steps.push({ tree: [[3]], rootIdx: 0, inMid: 1, leftIn: [0], rightIn: [2, 3, 4], highlightLines: [3, 4], explanation: { title: 'Root = 3', text: 'In inorder: left=[9], right=[15,20,7]' }});
            steps.push({ tree: [[3], [9, 20]], rootIdx: 1, highlightLines: [6, 8], explanation: { title: 'Build children', text: 'Left=9, Right=20' }});
            steps.push({ tree: [[3], [9, 20], ['', '', 15, 7]], highlightLines: [6, 8], explanation: { title: 'Build grandchildren', text: '20\'s children: 15, 7' }});
            steps.push({ tree: [[3], [9, 20], ['', '', 15, 7]], done: true, highlightLines: [9], explanation: { title: 'Done!', text: 'Tree constructed successfully' }});
            return steps;
        }

        let viz;
        function init() {
            viz = new AlgorithmVisualizer({
                codeLines: codeStructure,
                onStepChange: (step) => {
                    // Preorder display
                    document.getElementById('preorderDisplay').innerHTML = preorder.map((v, i) => `<span class="arr-item ${i === 0 ? 'root' : ''}">${v}</span>`).join('');
                    // Inorder display
                    document.getElementById('inorderDisplay').innerHTML = inorder.map((v, i) => {
                        let cls = 'arr-item';
                        if (step.inMid !== undefined && i < step.inMid) cls += ' left';
                        else if (step.inMid !== undefined && i > step.inMid) cls += ' right';
                        else if (step.inMid === i) cls += ' root';
                        return `<span class="${cls}">${v}</span>`;
                    }).join('');
                    // Tree display
                    let html = '';
                    (step.tree || []).forEach(level => {
                        html += '<div class="tree-level">' + level.map(v => v ? `<div class="tree-node">${v}</div>` : '<div style="width:32px"></div>').join('') + '</div>';
                    });
                    document.getElementById('treeDisplay').innerHTML = html || '<em style="color:var(--viz-text-muted)">Building...</em>';
                }
            });
            viz.setSteps(generateAlgorithmSteps());
        }
        function resetVisualization() { init(); }
        window.addEventListener('load', init);
    </script>
</body>
</html>
