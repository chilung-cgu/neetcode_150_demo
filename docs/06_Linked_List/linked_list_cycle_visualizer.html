<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linked List Cycle - ç²¾ç·»è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .visualization-area { background: linear-gradient(135deg, #1e293b 0%, #0f172a 50%, #1e293b 100%); border-radius: 16px; padding: 30px 20px; margin: 15px 0; }
        .cycle-container { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .nodes-row { display: flex; align-items: center; justify-content: center; gap: 0; }
        .node-wrapper { display: flex; align-items: center; position: relative; }
        .node { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.2rem; border-radius: 50%; background: linear-gradient(145deg, #3b82f6, #2563eb); color: white; position: relative; transition: all 0.4s; border: 3px solid transparent; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); }
        .node.slow { border-color: #22c55e; box-shadow: 0 0 25px rgba(34, 197, 94, 0.6); }
        .node.fast { border-color: #ef4444; box-shadow: 0 0 25px rgba(239, 68, 68, 0.6); }
        .node.meeting { background: linear-gradient(145deg, #fbbf24, #f59e0b); animation: meeting-pulse 0.5s infinite alternate; }
        .node.cycle-start { background: linear-gradient(145deg, #a855f7, #9333ea); box-shadow: 0 4px 15px rgba(168, 85, 247, 0.4); }
        @keyframes meeting-pulse { from { transform: scale(1); } to { transform: scale(1.2); box-shadow: 0 0 40px rgba(251, 191, 36, 0.8); } }
        .node-pointer-label { position: absolute; bottom: -22px; left: 50%; transform: translateX(-50%); font-size: 0.65rem; font-weight: 700; padding: 2px 6px; border-radius: 4px; }
        .node-pointer-label.slow { background: #22c55e; color: #0f172a; }
        .node-pointer-label.fast { background: #ef4444; color: white; }
        .link { width: 30px; height: 20px; display: flex; align-items: center; justify-content: center; }
        .link svg { width: 30px; height: 20px; }
        .cycle-arrow { position: relative; width: 100%; text-align: center; color: #a855f7; font-size: 0.85rem; margin-top: 10px; }
        .cycle-arrow::before { content: 'â†© cycle back to '; }
        .legend-bar { display: flex; justify-content: center; gap: 20px; padding: 15px; background: rgba(30, 41, 59, 0.5); border-radius: 12px; margin-top: 15px; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; color: #94a3b8; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
        .legend-dot.slow { border: 2px solid #22c55e; background: transparent; }
        .legend-dot.fast { border: 2px solid #ef4444; background: transparent; }
        .legend-dot.meeting { background: linear-gradient(145deg, #fbbf24, #f59e0b); }
        .legend-dot.cycle { background: linear-gradient(145deg, #a855f7, #9333ea); }
        .step-breakdown { background: rgba(30, 41, 59, 0.6); border-radius: 12px; padding: 15px 20px; margin-top: 15px; border-left: 4px solid #3b82f6; }
        .step-breakdown-title { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; color: #64748b; margin-bottom: 8px; }
        .step-breakdown-text { font-size: 0.95rem; color: #e2e8f0; font-family: 'Consolas', monospace; }
        .custom-input-section { background: var(--viz-card-bg); border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--viz-border); }
        .input-title { font-weight: bold; margin-bottom: 10px; }
        .input-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .input-row input, .input-row select { padding: 8px 12px; border-radius: 6px; border: 1px solid var(--viz-border); background: var(--viz-input-bg); color: var(--viz-text); font-family: monospace; }
        .input-row button { padding: 8px 16px; border-radius: 6px; background: var(--viz-primary); color: white; border: none; cursor: pointer; font-weight: 600; }
        .code-line.active { background: rgba(251, 191, 36, 0.15) !important; border-left: 3px solid #fbbf24 !important; }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">Linked List Cycle Detection - Floyd é¾œå…”è³½è·‘</div>
                <div class="custom-input-section">
                    <div class="input-title">ğŸ® è‡ªè¨‚æ¸¬è©¦</div>
                    <div class="input-row">
                        <input type="text" id="customList" value="3,2,0,-4" style="width: 120px;">
                        <label>cycle at:</label>
                        <select id="cyclePos"><option value="1">index 1</option><option value="0">index 0</option><option value="-1">no cycle</option></select>
                        <button onclick="runCustomInput()">åŸ·è¡Œ</button>
                    </div>
                </div>
                <div class="visualization-area">
                    <div class="cycle-container">
                        <div class="nodes-row" id="nodesRow"></div>
                        <div class="cycle-arrow" id="cycleArrow" style="display: none;"></div>
                    </div>
                    <div class="legend-bar">
                        <div class="legend-item"><div class="legend-dot slow"></div>slow (èµ° 1 æ­¥)</div>
                        <div class="legend-item"><div class="legend-dot fast"></div>fast (èµ° 2 æ­¥)</div>
                        <div class="legend-item"><div class="legend-dot meeting"></div>ç›¸é‡é»</div>
                        <div class="legend-item"><div class="legend-dot cycle"></div>Cycle èµ·é»</div>
                    </div>
                </div>
                <div class="step-breakdown">
                    <div class="step-breakdown-title">Step Breakdown</div>
                    <div class="step-breakdown-text" id="stepBreakdown">é»æ“Šã€Œä¸‹ä¸€æ­¥ã€é–‹å§‹</div>
                </div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                    <button class="viz-btn play-btn" id="playBtn" onclick="viz.toggleAutoPlay()">â–¶ è‡ªå‹•æ’­æ”¾</button>
                    <div class="speed-control"><label>é€Ÿåº¦:</label><select id="speedSelect" onchange="viz.setSpeed(Number(this.value))"><option value="2000">0.5x</option><option value="1500" selected>1x</option><option value="1000">1.5x</option><option value="500">2x</option></select></div>
                </div>
                <div class="complexity-badge"><span class="label">Time:</span> O(n) <span class="label" style="margin-left: 12px;">Space:</span> O(1)</div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area"><div class="viz-card" style="height: 100%;"><div class="viz-title">æ¼”ç®—æ³• (C++)</div><div class="code-panel" id="codeDisplay"></div></div></div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'bool hasCycle(ListNode *head) {', id: 0 },
            { line: '    ListNode *slow = head, *fast = head;', id: 1 },
            { line: '    while (fast && fast->next) {', id: 2 },
            { line: '        slow = slow->next;        // èµ° 1 æ­¥', id: 3 },
            { line: '        fast = fast->next->next;  // èµ° 2 æ­¥', id: 4 },
            { line: '        if (slow == fast) return true; // ç›¸é‡', id: 5 },
            { line: '    }', id: 6 },
            { line: '    return false; // fast åˆ°é” null', id: 7 },
            { line: '}', id: 8 },
        ];
        let currentList = [3, 2, 0, -4], cyclePos = 1, viz;
        function createArrowSVG() { return `<svg viewBox="0 0 30 20"><path d="M 3 10 L 22 10" stroke="#64748b" stroke-width="2" fill="none"/><polygon points="22,10 16,6 16,14" fill="#64748b"/></svg>`; }
        function generateAlgorithmSteps(list, cycleAt) {
            const steps = [];
            const n = list.length;
            const hasCycle = cycleAt >= 0 && cycleAt < n;
            steps.push({ list, slowIdx: 0, fastIdx: 0, cycleAt, highlightLines: [0, 1], stepText: 'slow = fast = head', explanation: { title: 'åˆå§‹åŒ–', text: `éˆè¡¨ï¼š${list.join(' â†’ ')}${hasCycle ? ` â†’ (cycle to ${list[cycleAt]})` : ' â†’ null'}<br><br>slow å’Œ fast éƒ½å¾ head é–‹å§‹`, formula: 'Floyd Cycle Detection' } });
            let slow = 0, fast = 0, met = false, maxSteps = n * 3;
            for (let step = 0; step < maxSteps && !met; step++) {
                slow = hasCycle ? (slow + 1) % n : Math.min(slow + 1, n);
                fast = hasCycle ? (fast + 2) % n : Math.min(fast + 2, n + 1);
                if (!hasCycle && fast >= n) {
                    steps.push({ list, slowIdx: slow < n ? slow : null, fastIdx: null, cycleAt, highlightLines: [7], stepText: 'fast åˆ°é” null â†’ ç„¡ cycle', explanation: { title: 'ç„¡ Cycle', text: `fast å·²åˆ°é” null<br><br>çµè«–ï¼šæ­¤éˆè¡¨æ²’æœ‰ cycle`, formula: 'return false' } });
                    break;
                }
                if (hasCycle && slow === fast) {
                    met = true;
                    steps.push({ list, slowIdx: slow, fastIdx: fast, meeting: true, cycleAt, highlightLines: [5], stepText: `slow == fast @ ${list[slow]} â†’ æœ‰ cycle!`, explanation: { title: 'ğŸ‰ ç›¸é‡ï¼', text: `slow å’Œ fast åœ¨ç¯€é» ${list[slow]} ç›¸é‡<br><br>çµè«–ï¼šæ­¤éˆè¡¨æœ‰ cycle`, formula: 'return true' } });
                } else {
                    steps.push({ list, slowIdx: slow < n ? slow : null, fastIdx: fast < n ? fast : null, cycleAt, highlightLines: [2, 3, 4], stepText: `slow = ${list[slow]}; fast = ${list[fast % n]}`, explanation: { title: 'ç§»å‹•æŒ‡æ¨™', text: `slow èµ° 1 æ­¥ â†’ ${list[slow]}<br>fast èµ° 2 æ­¥ â†’ ${list[fast % n]}`, formula: 'slow += 1; fast += 2' } });
                }
            }
            return steps;
        }
        function renderStep(step) {
            const row = document.getElementById('nodesRow');
            let html = '';
            step.list.forEach((v, i) => {
                let cls = 'node';
                let labels = '';
                if (step.cycleAt === i) cls += ' cycle-start';
                if (step.meeting && step.slowIdx === i) cls += ' meeting';
                else {
                    if (step.slowIdx === i) { cls += ' slow'; labels += '<span class="node-pointer-label slow">slow</span>'; }
                    if (step.fastIdx === i && step.slowIdx !== i) { cls += ' fast'; labels += '<span class="node-pointer-label fast">fast</span>'; }
                    if (step.slowIdx === i && step.fastIdx === i && !step.meeting) labels = '<span class="node-pointer-label slow">slow</span><span class="node-pointer-label fast" style="bottom:-36px">fast</span>';
                }
                html += `<div class="node-wrapper"><div class="${cls}">${v}${labels}</div>`;
                if (i < step.list.length - 1) html += `<div class="link">${createArrowSVG()}</div>`;
                html += '</div>';
            });
            row.innerHTML = html;
            const arrow = document.getElementById('cycleArrow');
            if (step.cycleAt >= 0) { arrow.style.display = 'block'; arrow.textContent = `â¤´ cycle back to index ${step.cycleAt} (${step.list[step.cycleAt]})`; }
            else { arrow.style.display = 'none'; }
            document.getElementById('stepBreakdown').textContent = step.stepText || '';
        }
        function init(list = currentList, cycle = cyclePos) { currentList = list; cyclePos = cycle; viz = new AlgorithmVisualizer({ codeLines: codeStructure, onStepChange: renderStep }); viz.setSteps(generateAlgorithmSteps(list, cycle)); }
        function runCustomInput() { const list = document.getElementById('customList').value.split(',').map(s => parseInt(s.trim())).filter(x => !isNaN(x)); const cycle = parseInt(document.getElementById('cyclePos').value); if (list.length < 1) { alert('è«‹è¼¸å…¥ç¯€é»'); return; } init(list, cycle); }
        function resetVisualization() { init(); }
        window.addEventListener('load', () => init());
    </script>
</body>
</html>
