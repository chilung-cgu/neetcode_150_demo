<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove Nth Node From End - ç²¾ç·»è¦–è¦ºåŒ–</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css">
    <style>
        .visualization-area { background: linear-gradient(135deg, #1e293b 0%, #0f172a 50%, #1e293b 100%); border-radius: 16px; padding: 30px 20px; margin: 15px 0; }
        .nodes-row { display: flex; align-items: center; justify-content: center; padding: 40px 20px 30px; }
        .node-wrapper { display: flex; align-items: center; position: relative; }
        .node { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.2rem; border-radius: 50%; background: linear-gradient(145deg, #3b82f6, #2563eb); color: white; position: relative; transition: all 0.4s; border: 3px solid transparent; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); }
        .node.dummy { background: linear-gradient(145deg, #475569, #334155); font-size: 0.8rem; }
        .node.fast { border-color: #ef4444; box-shadow: 0 0 25px rgba(239, 68, 68, 0.6); }
        .node.slow { border-color: #22c55e; box-shadow: 0 0 25px rgba(34, 197, 94, 0.6); }
        .node.target { background: linear-gradient(145deg, #ef4444, #dc2626); animation: pulse 0.5s infinite alternate; }
        .node.removed { opacity: 0.3; transform: scale(0.8); text-decoration: line-through; }
        @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.15); box-shadow: 0 0 30px rgba(239, 68, 68, 0.8); } }
        .node-pointer-label { position: absolute; bottom: -22px; left: 50%; transform: translateX(-50%); font-size: 0.65rem; font-weight: 700; padding: 2px 6px; border-radius: 4px; white-space: nowrap; }
        .node-pointer-label.fast { background: #ef4444; color: white; }
        .node-pointer-label.slow { background: #22c55e; color: #0f172a; }
        .link { width: 30px; height: 20px; display: flex; align-items: center; justify-content: center; }
        .link svg { width: 30px; height: 20px; }
        .gap-indicator { position: absolute; top: -35px; left: 50%; transform: translateX(-50%); background: rgba(251, 191, 36, 0.2); border: 2px solid #fbbf24; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; color: #fbbf24; }
        .legend-bar { display: flex; justify-content: center; gap: 20px; padding: 15px; background: rgba(30, 41, 59, 0.5); border-radius: 12px; margin-top: 15px; }
        .legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; color: #94a3b8; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
        .legend-dot.fast { border: 2px solid #ef4444; background: transparent; }
        .legend-dot.slow { border: 2px solid #22c55e; background: transparent; }
        .legend-dot.target { background: linear-gradient(145deg, #ef4444, #dc2626); }
        .step-breakdown { background: rgba(30, 41, 59, 0.6); border-radius: 12px; padding: 15px 20px; margin-top: 15px; border-left: 4px solid #3b82f6; }
        .step-breakdown-title { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; color: #64748b; margin-bottom: 8px; }
        .step-breakdown-text { font-size: 0.95rem; color: #e2e8f0; font-family: 'Consolas', monospace; }
        .custom-input-section { background: var(--viz-card-bg); border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--viz-border); }
        .input-title { font-weight: bold; margin-bottom: 10px; }
        .input-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .input-row input { padding: 8px 12px; border-radius: 6px; border: 1px solid var(--viz-border); background: var(--viz-input-bg); color: var(--viz-text); font-family: monospace; }
        .input-row button { padding: 8px 16px; border-radius: 6px; background: var(--viz-primary); color: white; border: none; cursor: pointer; font-weight: 600; }
        .code-line.active { background: rgba(251, 191, 36, 0.15) !important; border-left: 3px solid #fbbf24 !important; }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“</button>
    <div class="main-layout">
        <div class="canvas-area">
            <div class="viz-card">
                <div class="viz-title">ç§»é™¤å€’æ•¸ç¬¬ N å€‹ç¯€é» - é›™æŒ‡é‡è¦–è¦ºåŒ–</div>
                <div class="custom-input-section">
                    <div class="input-title">ğŸ® è‡ªè¨‚æ¸¬è©¦</div>
                    <div class="input-row">
                        <input type="text" id="customList" value="1,2,3,4,5" style="width: 120px;">
                        <label>n =</label>
                        <input type="number" id="customN" value="2" min="1" style="width: 60px;">
                        <button onclick="runCustomInput()">åŸ·è¡Œ</button>
                    </div>
                </div>
                <div class="visualization-area">
                    <div class="nodes-row" id="nodesRow"></div>
                    <div class="legend-bar">
                        <div class="legend-item"><div class="legend-dot fast"></div>fast æŒ‡æ¨™</div>
                        <div class="legend-item"><div class="legend-dot slow"></div>slow æŒ‡æ¨™</div>
                        <div class="legend-item"><div class="legend-dot target"></div>å¾…ç§»é™¤</div>
                    </div>
                </div>
                <div class="step-breakdown">
                    <div class="step-breakdown-title">Step Breakdown</div>
                    <div class="step-breakdown-text" id="stepBreakdown">é»æ“Šã€Œä¸‹ä¸€æ­¥ã€é–‹å§‹</div>
                </div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="viz-btn" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
                    <div class="step-indicator">æ­¥é©Ÿ <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <button class="viz-btn primary" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button>
                    <button class="viz-btn" onclick="resetVisualization()">â†» é‡ç½®</button>
                    <button class="viz-btn play-btn" id="playBtn" onclick="viz.toggleAutoPlay()">â–¶ è‡ªå‹•æ’­æ”¾</button>
                    <div class="speed-control"><label>é€Ÿåº¦:</label><select id="speedSelect" onchange="viz.setSpeed(Number(this.value))"><option value="2000">0.5x</option><option value="1500" selected>1x</option><option value="1000">1.5x</option><option value="500">2x</option></select></div>
                </div>
                <div class="complexity-badge"><span class="label">Time:</span> O(n) <span class="label" style="margin-left: 12px;">Space:</span> O(1)</div>
            </div>
            <div class="viz-card"><div class="viz-title">æ¼”ç®—æ³•èªªæ˜</div><div class="explanation" id="explanation"></div></div>
        </div>
        <div class="code-area"><div class="viz-card" style="height: 100%;"><div class="viz-title">æ¼”ç®—æ³• (C++)</div><div class="code-panel" id="codeDisplay"></div></div></div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
        const codeStructure = [
            { line: 'ListNode* removeNthFromEnd(ListNode* head, int n) {', id: 0 },
            { line: '    ListNode dummy(0, head);', id: 1 },
            { line: '    ListNode *fast = &dummy, *slow = &dummy;', id: 2 },
            { line: '    // fast å…ˆèµ° n+1 æ­¥', id: 3 },
            { line: '    for (int i = 0; i <= n; i++) fast = fast->next;', id: 4 },
            { line: '    // fast å’Œ slow åŒæ™‚èµ°', id: 5 },
            { line: '    while (fast) {', id: 6 },
            { line: '        fast = fast->next;', id: 7 },
            { line: '        slow = slow->next;', id: 8 },
            { line: '    }', id: 9 },
            { line: '    // slow ç¾åœ¨æŒ‡å‘å¾…åˆªç¯€é»çš„å‰ä¸€å€‹', id: 10 },
            { line: '    slow->next = slow->next->next;', id: 11 },
            { line: '    return dummy.next;', id: 12 },
            { line: '}', id: 13 },
        ];
        let currentList = [1, 2, 3, 4, 5], currentN = 2, viz;
        function createArrowSVG() { return `<svg viewBox="0 0 30 20"><path d="M 3 10 L 22 10" stroke="#64748b" stroke-width="2" fill="none"/><polygon points="22,10 16,6 16,14" fill="#64748b"/></svg>`; }
        function generateAlgorithmSteps(list, n) {
            const steps = [];
            const len = list.length;
            const targetIdx = len - n; // 0-indexed position of node to remove
            steps.push({ list: [...list], fastIdx: -1, slowIdx: -1, phase: 'init', highlightLines: [0, 1, 2], stepText: 'dummy + fast/slow åˆå§‹åŒ–', explanation: { title: 'åˆå§‹åŒ–', text: `éˆè¡¨ï¼š${list.join(' â†’ ')}<br>n = ${n}<br><br>ä½¿ç”¨ dummy ç¯€é»ç°¡åŒ–é‚Šç•Œè™•ç†`, formula: `ç›®æ¨™ï¼šç§»é™¤å€’æ•¸ç¬¬ ${n} å€‹ = æ­£æ•¸ç¬¬ ${targetIdx + 1} å€‹ (${list[targetIdx]})` } });
            // Fast moves n+1 steps
            for (let i = 0; i <= n && i <= len; i++) {
                steps.push({ list: [...list], fastIdx: i - 1, slowIdx: -1, phase: 'advance', highlightLines: [3, 4], stepText: `fast å‰é€²ç¬¬ ${i + 1} æ­¥`, explanation: { title: `fast å…ˆèµ° ${n + 1} æ­¥`, text: `fast èµ°äº† ${i + 1} æ­¥<br>é‚„éœ€èµ° ${n - i} æ­¥`, formula: `gap = ${n + 1}` } });
            }
            // Both move together
            let fast = n, slow = -1;
            while (fast < len) {
                fast++; slow++;
                steps.push({ list: [...list], fastIdx: fast - 1 < len ? fast - 1 : null, slowIdx: slow, phase: 'together', highlightLines: [5, 6, 7, 8], stepText: `fast = ${fast < len ? list[fast] : 'null'}; slow = ${slow >= 0 && slow < len ? list[slow] : 'dummy'}`, explanation: { title: 'åŒæ­¥ç§»å‹•', text: `fast å’Œ slow åŒæ™‚å‰é€²<br><br>ç•¶ fast åˆ°é”æœ«å°¾æ™‚ï¼Œslow æ°å¥½åœ¨ç›®æ¨™å‰ä¸€å€‹ä½ç½®`, formula: `gap = ${n + 1} (å›ºå®š)` } });
            }
            // Target found
            steps.push({ list: [...list], fastIdx: null, slowIdx: slow, targetIdx, phase: 'found', highlightLines: [10], stepText: `æ‰¾åˆ°ç›®æ¨™: ${list[targetIdx]}`, explanation: { title: 'å®šä½ç›®æ¨™', text: `slow æŒ‡å‘ç´¢å¼• ${slow} (${slow >= 0 ? list[slow] : 'dummy'})<br>å¾…ç§»é™¤ï¼šslowâ†’next = ${list[targetIdx]}`, formula: `slowâ†’next = å€’æ•¸ç¬¬ ${n} å€‹` } });
            // Remove
            const result = list.filter((_, i) => i !== targetIdx);
            steps.push({ list: result, phase: 'done', removedVal: list[targetIdx], highlightLines: [11, 12], stepText: `slow->next = slow->next->next`, explanation: { title: 'ğŸ‰ ç§»é™¤å®Œæˆï¼', text: `ç§»é™¤äº† ${list[targetIdx]}<br><br>çµæœï¼š${result.join(' â†’ ')}`, formula: `return dummy.next` } });
            return steps;
        }
        function renderStep(step) {
            const row = document.getElementById('nodesRow');
            let html = '<div class="node-wrapper"><div class="node dummy">D';
            if (step.slowIdx === -1 && step.phase !== 'done') html += '<span class="node-pointer-label slow">slow</span>';
            if (step.fastIdx === -1 && step.phase === 'advance') html += '<span class="node-pointer-label fast">fast</span>';
            html += `</div><div class="link">${createArrowSVG()}</div></div>`;
            step.list.forEach((v, i) => {
                let cls = 'node';
                let labels = '';
                if (step.targetIdx === i && step.phase === 'found') cls += ' target';
                if (step.slowIdx === i) { cls += ' slow'; labels += '<span class="node-pointer-label slow">slow</span>'; }
                if (step.fastIdx === i) { cls += ' fast'; labels += '<span class="node-pointer-label fast">fast</span>'; }
                html += `<div class="node-wrapper"><div class="${cls}">${v}${labels}</div>`;
                if (i < step.list.length - 1) html += `<div class="link">${createArrowSVG()}</div>`;
                html += '</div>';
            });
            row.innerHTML = html;
            document.getElementById('stepBreakdown').textContent = step.stepText || '';
        }
        function init(list = currentList, n = currentN) { currentList = list; currentN = n; viz = new AlgorithmVisualizer({ codeLines: codeStructure, onStepChange: renderStep }); viz.setSteps(generateAlgorithmSteps(list, n)); }
        function runCustomInput() { const list = document.getElementById('customList').value.split(',').map(s => parseInt(s.trim())).filter(x => !isNaN(x)); const n = parseInt(document.getElementById('customN').value); if (list.length < 1 || n < 1 || n > list.length) { alert('è«‹ç¢ºä¿ 1 â‰¤ n â‰¤ ç¯€é»æ•¸'); return; } init(list, n); }
        function resetVisualization() { init(); }
        window.addEventListener('load', () => init());
    </script>
</body>
</html>
