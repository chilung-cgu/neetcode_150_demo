<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Encode and Decode Strings Visualization</title>
    <link rel="stylesheet" href="../assets/visualizer/style.css" />
    <style>
      .string-box {
        background: rgba(0, 0, 0, 0.3);
        padding: 12px;
        border-radius: 8px;
        font-family: monospace;
        margin: 8px 0;
        word-break: break-all;
      }
      .encoded-char {
        display: inline;
      }
      .encoded-char.length {
        color: var(--viz-success);
      }
      .encoded-char.delimiter {
        color: var(--viz-secondary);
        font-weight: bold;
      }
      .encoded-char.content {
        color: var(--viz-text-main);
      }
      .encoded-char.active {
        background: var(--viz-secondary);
        color: #0f172a;
        padding: 0 2px;
        border-radius: 2px;
      }
      .input-list {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: center;
      }
      .input-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 6px 12px;
        border-radius: 6px;
      }
      .input-item.active {
        background: var(--viz-secondary);
        color: #0f172a;
      }
    </style>
  </head>
  <body>
    <button class="theme-toggle" onclick="AlgorithmVisualizer.toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ“</button>
    <div class="main-layout">
      <div class="canvas-area">
        <div class="viz-card">
          <div class="viz-title">ENCODE / DECODE</div>
          <div class="custom-input-section" style="margin: 10px 0; padding: 10px; background: var(--viz-bg-secondary); border-radius: 8px;">
            <div style="font-weight:bold; margin-bottom:8px;">ğŸ® è‡ªè¨‚æ¸¬è©¦</div>
            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
              <input type="text" id="customInput" value="hello,world,test#123" style="padding: 8px; border-radius: 6px; border: 1px solid var(--viz-border); background: var(--viz-bg); color: var(--viz-text); flex: 1; min-width: 200px;">
              <button onclick="runCustomInput()" style="padding: 8px 16px; background: var(--viz-primary); color: white; border: none; border-radius: 6px; cursor: pointer;">åŸ·è¡Œ</button>
            </div>
            <div style="font-size: 0.8rem; color: var(--viz-text-muted); margin-top: 5px;">ç”¨é€—è™Ÿåˆ†éš”å­—ä¸²ï¼Œä¾‹å¦‚: hello,world,test</div>
          </div>
          <div style="text-align: center; margin-bottom: 10px">
            <strong>Input Strings:</strong>
          </div>
          <div class="input-list" id="inputList"></div>
          <div style="text-align: center; margin: 15px 0">
            <strong>Encoded Result:</strong>
          </div>
          <div class="string-box" id="encodedBox"></div>
                <div class="complexity-badge">
                    <span class="label">Time:</span> O(1)
                    <span class="label" style="margin-left: 12px;">Space:</span> O(1)
                </div>
                <div class="state-grid" style="margin-top: 10px;">
            <button class="viz-btn" id="prevBtn">â† Prev</button>
            <div class="step-indicator">
              Step <span id="currentStep">0</span> /
              <span id="totalSteps">0</span>
            </div>
            <button class="viz-btn primary" id="nextBtn">Next â†’</button>
            <button class="viz-btn" onclick="resetVisualization()">
              â†» Reset
            </button>
            <div class="speed-control">
              <label>é€Ÿåº¦:</label>
              <select
                id="speedSelect"
                onchange="viz.setSpeed(Number(this.value))"
              >
                <option value="2000">0.5x</option>
                <option value="1500" selected>1x</option>
                <option value="1000">1.5x</option>
                <option value="500">2x</option>
              </select>
            </div>
          </div>
          <div class="complexity-badge">
            <span class="label">Time:</span> O(n)
            <span class="label" style="margin-left: 12px;">Space:</span> O(1)
          </div>
        <div class="legend">
                    <div class="legend-item"><div class="legend-color normal"></div>ä¸€èˆ¬</div>
                    <div class="legend-item"><div class="legend-color current"></div>ç›®å‰è™•ç†</div>
                    <div class="legend-item"><div class="legend-color in-stack"></div>å®Œæˆ</div>
                </div>
            </div>
        <div class="viz-card">
          <div class="viz-title">EXPLANATION</div>
          <div class="explanation" id="explanation"></div>
        </div>
      </div>
      <div class="code-area">
        <div class="viz-card" style="height: 100%; box-sizing: border-box">
          <div class="viz-title">ALGORITHM (C++)</div>
          <div class="code-panel" id="codeDisplay"></div>
        </div>
      </div>
    </div>
    <script src="../assets/visualizer/core.js"></script>
    <script>
      const codeStructure = [
        { line: "string encode(vector<string>& strs) {", id: 0 },
        { line: '    string encoded = "";', id: 1 },
        { line: "    for (const string& s : strs)", id: 2 },
        { line: '        encoded += to_string(s.length()) + "#" + s;', id: 3 },
        { line: "    return encoded;", id: 4 },
        { line: "}", id: 5 },
        { line: "", id: 6 },
        { line: "vector<string> decode(string s) {", id: 7 },
        { line: "    vector<string> decoded; int i = 0;", id: 8 },
        { line: "    while (i < s.length()) {", id: 9 },
        { line: "        int j = i; while (s[j] != '#') j++;", id: 10 },
        { line: "        int len = stoi(s.substr(i, j-i));", id: 11 },
        { line: "        decoded.push_back(s.substr(j+1, len));", id: 12 },
        { line: "        i = j + 1 + len;", id: 13 },
        { line: "    }", id: 14 },
        { line: "    return decoded;", id: 15 },
        { line: "}", id: 16 },
      ];

      let strs = ["hello", "world", "test#123"];

      function runCustomInput() {
        const input = document.getElementById('customInput').value;
        strs = input.split(',').map(s => s.trim()).filter(s => s.length > 0);
        if (strs.length === 0) strs = ["empty"];
        init();
      }

      function generateAlgorithmSteps() {
        const steps = [];
        let encoded = "";

        steps.push({
          phase: "encode_init",
          activeStr: -1,
          encoded: "",
          highlightLines: [0, 1],
          explanation: {
            title: "Start Encoding",
            text: `è¼¸å…¥: [${strs.map((s) => `"${s}"`).join(", ")}]`,
          },
        });

        strs.forEach((s, idx) => {
          const chunk = s.length + "#" + s;
          encoded += chunk;
          steps.push({
            phase: "encode",
            activeStr: idx,
            encoded,
            chunkStart: encoded.length - chunk.length,
            chunkEnd: encoded.length,
            highlightLines: [2, 3],
            explanation: {
              title: `Encode "${s}"`,
              text: `é•·åº¦=${s.length} â†’ "${chunk}"`,
            },
          });
        });

        steps.push({
          phase: "encode_done",
          activeStr: -1,
          encoded,
          highlightLines: [4],
          explanation: {
            title: "Encoding Complete",
            text: `ç·¨ç¢¼çµæœ: "${encoded}"`,
          },
        });

        let i = 0,
          decoded = [];
        steps.push({
          phase: "decode_init",
          decoded: [],
          pointer: 0,
          highlightLines: [7, 8],
          explanation: {
            title: "Start Decoding",
            text: `é–‹å§‹è§£ç¢¼ç·¨ç¢¼å¾Œçš„å­—ä¸²ã€‚`,
          },
        });

        while (i < encoded.length) {
          let j = i;
          while (encoded[j] !== "#") j++;
          const len = parseInt(encoded.substring(i, j));
          const str = encoded.substring(j + 1, j + 1 + len);
          decoded.push(str);
          steps.push({
            phase: "decode",
            decoded: [...decoded],
            pointer: i,
            lenEnd: j,
            contentEnd: j + 1 + len,
            encoded,
            highlightLines: [10, 11, 12],
            explanation: {
              title: `Decode: len=${len}`,
              text: `è®€å– ${len} å€‹å­—å…ƒ â†’ "${str}"`,
            },
          });
          i = j + 1 + len;
        }

        steps.push({
          phase: "done",
          decoded,
          encoded,
          highlightLines: [15],
          explanation: {
            title: "Decoding Complete",
            text: `è§£ç¢¼çµæœ: [${decoded.map((s) => `"${s}"`).join(", ")}]`,
          },
        });

        return steps;
      }

      function renderInputList(activeStr) {
        document.getElementById("inputList").innerHTML = strs
          .map(
            (s, i) =>
              `<div class="input-item ${i === activeStr ? "active" : ""}">"${s}"</div>`,
          )
          .join("");
      }

      function renderEncoded(step) {
        if (!step.encoded) {
          document.getElementById("encodedBox").innerHTML =
            '<em style="color:var(--viz-text-muted)">Empty</em>';
          return;
        }
        let html = "";
        for (let i = 0; i < step.encoded.length; i++) {
          const c = step.encoded[i];
          const isActive =
            step.pointer !== undefined &&
            i >= step.pointer &&
            i < (step.contentEnd || step.encoded.length);
          const cls =
            c === "#"
              ? "delimiter"
              : /\d/.test(c) && (step.lenEnd === undefined || i < step.lenEnd)
                ? "length"
                : "content";
          html += `<span class="encoded-char ${cls} ${isActive ? "active" : ""}">${c}</span>`;
        }
        document.getElementById("encodedBox").innerHTML = html;
      }

      let viz;
      function init() {
        viz = new AlgorithmVisualizer({
          codeLines: codeStructure,
          onStepChange: (step) => {
            renderInputList(step.activeStr ?? -1);
            renderEncoded(step);
          },
        });
        viz.setSteps(generateAlgorithmSteps());
      }
      function resetVisualization() {
        init();
      }
      window.addEventListener("load", init);
    </script>
  </body>
</html>
